=== src/lib/api.ts ===
import 'server-only';
import { cached } from './cache';
import { FALLBACK_MARKET_DATA } from './fallback-data';
import type {
  CoinMarketData,
  NewsArticle,
  DeFiProtocol,
  DexVolumePoint,
  StablecoinPoint,
} from './types';

const COINGECKO_BASE = 'https://api.coingecko.com/api/v3';
const DEFILLAMA_BASE = 'https://api.llama.fi';
const NEWS_API = 'https://min-api.cryptocompare.com/data/v2/news/?lang=EN';

// Safety wrapper for fetch
async function withTimeout<T>(promise: Promise<T>, timeoutMs: number, fallback: T): Promise<T> {
  let timeoutId: NodeJS.Timeout;
  const timeoutPromise = new Promise<T>((_, reject) => {
    timeoutId = setTimeout(() => reject(new Error('timeout')), timeoutMs);
  });
  return Promise.race([promise, timeoutPromise])
    .then((res) => { clearTimeout(timeoutId); return res; })
    .catch(() => fallback);
}

export async function getLivePrices(): Promise<CoinMarketData[]> {
  const task = async () => {
    const res = await fetch(`${COINGECKO_BASE}/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=50&sparkline=true&price_change_percentage=1h,24h,7d`, { cache: 'no-store' });
    return res.ok ? res.json() : FALLBACK_MARKET_DATA;
  };
  return withTimeout(task(), 5000, FALLBACK_MARKET_DATA);
}

export async function getRealNews(): Promise<NewsArticle[]> {
  const task = async () => {
    const res = await fetch(NEWS_API, { cache: 'no-store' });
    const data = await res.json();
    return data.Data.slice(0, 20).map((a: any) => ({
      id: String(a.id),
      title: a.title,
      body: a.body || "",
      image: a.imageurl,
      source: a.source_info?.name || 'Unknown',
      published_on: a.published_on,
      url: a.url,
      categories: a.categories?.split('|') || [],
      tags: a.tags?.split('|') || [],
    }));
  };
  return withTimeout(task(), 5000, []);
}

export async function getDeFiProtocols(): Promise<DeFiProtocol[]> {
  return cached('defi:protocols', async () => {
    const res = await fetch(`${DEFILLAMA_BASE}/protocols`, { cache: 'no-store' });
    const data = await res.json();
    if (!Array.isArray(data)) return [];
    return data.slice(0, 50).map((p: any) => ({
      name: p.name,
      chain: p.chain || 'Multi',
      category: p.category,
      tvl: p.tvl,
      change_1d: p.change_1d,
    }));
  }, 600);
}

export async function getDexVolume(): Promise<DexVolumePoint[]> {
  return cached('defi:dex-volume', async () => {
    const res = await fetch(`${DEFILLAMA_BASE}/overview/dexs?excludeTotalDataChart=false`, { cache: 'no-store' });
    const data = await res.json();
    if (!data?.totalDataChart) return [];
    return data.totalDataChart.slice(-30).map((d: any) => ({
      date: new Date(d[0] * 1000).toLocaleDateString('en-US', { month: 'short', day: 'numeric' }),
      volume: d[1],
    }));
  }, 3600);
}

export async function getStablecoinData(): Promise<StablecoinPoint[]> {
  return cached('defi:stables', async () => {
    const res = await fetch('https://stablecoins.llama.fi/stablecoincharts/all', { cache: 'no-store' });
    const data = await res.json();
    if (!Array.isArray(data)) return [];
    return data.slice(-30).map((d: any) => ({
      date: new Date(d.date * 1000).toLocaleDateString('en-US', { month: 'short', day: 'numeric' }),
      mcap: d.totalCirculating?.peggedUSD || 0,
    }));
  }, 3600);
}

export async function getArticleById(id: string) {
  const news = await getRealNews();
  return news.find(a => a.id === id) || null;
}

export async function getRelatedArticles(id: string) {
  const news = await getRealNews();
  return news.filter(a => a.id !== id).slice(0, 4);
}

export function calculateReadingTime(text: string) {
  const words = (text || "").split(/\s+/).length;
  return Math.max(1, Math.ceil(words / 200));
}

=== src/lib/categories.ts ===
export const CRYPTO_CATEGORIES = [
  "All Coins",
  "Solana Ecosystem",
  "Stablecoins",
  "Meme Token",
  "Layer 1",
  "Smart Contract Platform",
  "DeFi",
  "Fantom Ecosystem",
  "DragonFly Capital Portfolio",
  "Move VM",
  "Fabric Ventures Portfolio",
  "BoostVC Portfolio",
  "Arrington XRP Capital Portfolio",
  "Analytics",
  "TRON Ecosystem",
  "Filesharing",
  "DePIN",
  "Four Meme Ecosystem",
  "Loyalty",
  "DeFiance Capital Portfolio",
  "Hybrid token standard",
  "HECO Ecosystem",
  "Identity",
  "Animoca Brands Portfolio",
  "Binance Smart Chain",
  "Celo Ecosystem",
  "Music",
  "Lending Borrowing",
  "Oracles",
  "Seedify",
  "Privacy",
  "Fenbushi Capital Portfolio",
  "DEX",
  "Parallel EVM",
  "Polkastarter",
  "Standard Crypto Portfolio",
  "MultiversX Ecosystem",
  "Interoperability",
  "Gaming Guild",
  "Mobile Mining",
  "EigenLayer Ecosystem",
  "DAO",
  "Cat-Themed",
  "Inscriptions",
  "IoT",
  "Terra Ecosystem",
  "Arbitrum Ecosystem",
  "Internet Computer Ecosystem",
  "eGirl Capital Portfolio",
  "Generative AI",
  "Bitcoin Ecosystem",
  "Bittensor Ecosystem",
  "Osmosis Ecosystem",
  "Sonic Ecosystem",
  "YZi Labs Portfolio",
  "TokenFi Launchpad",
  "Olympus Pro Ecosystem",
  "CMS Holdings Portfolio",
  "BTCfi",
  "Tokenized Assets",
  "Play To Earn",
  "Polygon Ecosystem",
  "Oasis Ecosystem",
  "Injective Ecosystem",
  "Near Protocol Ecosystem",
  "Binance Launchpad",
  "Real World Assets",
  "Moonshot",
  "Polkadot Ecosystem",
  "Research",
  "Algorithmic Stablecoin",
  "Liquid Staking Derivatives",
  "Toncoin Ecosystem",
  "Ethereum Ecosystem",
  "Circle Ventures Portfolio",
  "Blockchain Capital Portfolio",
  "Cardano Ecosystem",
  "Smart Contracts",
  "Tokenized Gold",
  "Gaming",
  "Entertainment",
  "Derivatives",
  "Framework Ventures Portfolio",
  "AI Memes",
  "MetisDAO Ecosystem",
  "Rollups-as-a-Service",
  "Coinfund Portfolio",
  "DeSci",
  "XDC Ecosystem",
  "Centralized Exchange Token",
  "Content Creation",
  "Celebrity Memes",
  "DCG Portfolio",
  "Zero Knowledge Proofs",
  "Tap To Earn",
  "Data Availability",
  "Video",
  "Tokenized commodities",
  "AI Agents",
  "SEI Ecosystem",
  "BRC-20",
  "Restaking",
  "Hyperliquid Ecosystem",
  "Scaling",
  "Account Abstraction",
  "Animal Memes",
  "Electric Global Portfolio",
  "PetRock Capital Portfolio",
  "DeFAI",
  "Optimism Ecosystem",
  "Metaverse",
  "Synthetics",
  "Runes",
  "Prediction Markets",
  "Sharing Economy",
  "Aptos Ecosystem",
  "SUI Ecosystem",
  "Blast Ecosystem",
  "Tezos Ecosystem",
  "Masternodes",
  "Modular Blockchain",
  "Avalanche Ecosystem"
];

=== src/lib/dune.ts ===
import { DuneClient } from '@duneanalytics/client-sdk';
import { cached } from './cache';

export const QUERY_IDS = {
  WHALE_TRANSFERS: 6695545, 
  LARGE_DEX_SWAPS: 6695545, 
  CEX_NET_FLOWS: 6695545,   
} as const;

let client: DuneClient | null = null;

function getClient(): DuneClient {
  if (!client) {
    const key = process.env.DUNE_API_KEY;
    if (!key) throw new Error('DUNE_API_KEY not set');
    client = new DuneClient(key);
  }
  return client;
}

export async function queryDune<T = Record<string, unknown>>(
  queryId: number,
  params?: Record<string, string | number | boolean>,
  ttlSeconds = 120
): Promise<T[]> {
  const cacheKey = `dune:${queryId}:${JSON.stringify(params || {})}`;

  return cached(cacheKey, async () => {
    try {
      const dune = getClient();

      // Transform into SDK format. 
      // We use 'as any' to bypass the SDK's internal ParameterType mismatch.
      const formattedParams = params 
        ? Object.entries(params).map(([key, value]) => ({
            name: key,
            value: String(value),
            type: typeof value === 'number' ? 'number' : 'text'
          }))
        : undefined;

      const result = await dune.runQuery({
        queryId,
        query_parameters: formattedParams as any,
      });

      return (result?.result?.rows || []) as T[];
    } catch (error) {
      console.error(`[Dune] Query ${queryId} failed:`, error);
      return [];
    }
  }, ttlSeconds);
}

export interface WhaleTransfer {
  block_time: string;
  sender: string;
  receiver: string;
  token_symbol: string;
  amount: number;
  usd_value: number;
  tx_hash: string;
  chain: string;
}

export interface DexSwap {
  block_time: string;
  project: string;
  token_a_symbol: string;
  token_b_symbol: string;
  token_a_amount: number;
  token_b_amount: number;
  usd_amount: number;
  tx_hash: string;
}

export async function getWhaleTransfers(): Promise<WhaleTransfer[]> {
  return queryDune<WhaleTransfer>(QUERY_IDS.WHALE_TRANSFERS, {}, 120);
}

export async function getLargeDexSwaps(): Promise<DexSwap[]> {
  return queryDune<DexSwap>(QUERY_IDS.LARGE_DEX_SWAPS, {}, 120);
}

=== src/lib/cache.ts ===
// src/lib/cache.ts
// ─── In-Memory LRU Cache ──────────────────────────────────────────────────
// NOTE: On Vercel serverless, this cache is per-isolate and resets on cold starts.
// For persistent caching, integrate Redis/Upstash when ready.

interface CacheEntry<T> {
  data: T;
  expiresAt: number;
}

const store = new Map<string, CacheEntry<unknown>>();
const MAX_ENTRIES = 200;

export async function cached<T>(
  key: string,
  fn: () => Promise<T>,
  ttlSeconds = 300
): Promise<T> {
  const existing = store.get(key) as CacheEntry<T> | undefined;

  if (existing && Date.now() < existing.expiresAt) {
    // Move to end (LRU refresh) — Map preserves insertion order
    store.delete(key);
    store.set(key, existing);
    return existing.data;
  }

  try {
    const data = await fn();

    // Evict oldest entry if at capacity
    if (store.size >= MAX_ENTRIES) {
      const oldestKey = store.keys().next().value;
      if (oldestKey) store.delete(oldestKey);
    }

    store.set(key, {
      data,
      expiresAt: Date.now() + ttlSeconds * 1000,
    });

    return data;
  } catch (error) {
    // If we have stale data, return it rather than throwing
    if (existing) {
      console.warn(`[Cache] Returning stale data for "${key}"`);
      return existing.data;
    }
    console.error(`[Cache] Fetch failed for "${key}"`, error);
    throw error;
  }
}

=== src/lib/types.ts ===
export interface CoinMarketData {
  id: string;
  market_cap_rank?: number;
  name: string;
  symbol: string;
  image: string;
  current_price: number;
  price_change_percentage_24h: number | null;
  price_change_percentage_1h_in_currency: number | null;
  price_change_percentage_7d_in_currency: number | null;
  market_cap: number;
  total_volume: number;
  sparkline_in_7d?: { price: number[] };
}

export interface NewsArticle {
  id: string;
  title: string;
  body: string;
  image: string;
  url: string;
  source: string;
  published_on: number;
  categories?: string[]; // Array of strings
  tags?: string[];       // Array of strings
}

export interface DeFiProtocol {
  name: string;
  chain: string;
  chains?: string[];
  category: string;
  tvl: number;
  change_1d: number | null;
  change_7d?: number | null;
}

export interface DexVolumePoint {
  date: string;
  volume: number;
}

export interface StablecoinPoint {
  date: string;
  mcap: number;
}

export interface PriceTableRow {
  id: string;
  rank: number;
  name: string;
  symbol: string;
  image: string;
  price: number;
  change1h: number;
  change24h: number;
  change7d: number;
  marketCap: number;
  volume24h: number;
  sparkline: number[];
}

=== src/lib/fallback-data.ts ===
// src/lib/fallback-data.ts
// ─── Static fallback for when CoinGecko is rate-limited or down ──────────
import type { CoinMarketData } from './types';

export const FALLBACK_MARKET_DATA: CoinMarketData[] = [
  {
    id: 'bitcoin',
    market_cap_rank: 1,
    name: 'Bitcoin',
    symbol: 'btc',
    image: 'https://assets.coingecko.com/coins/images/1/large/bitcoin.png',
    current_price: 76038,
    price_change_percentage_24h: -2.86,
    price_change_percentage_1h_in_currency: -0.1,
    price_change_percentage_7d_in_currency: 12.5,
    market_cap: 1500000000000,
    total_volume: 45000000000,
    sparkline_in_7d: { price: Array(168).fill(76000) },
  },
  {
    id: 'ethereum',
    market_cap_rank: 2,
    name: 'Ethereum',
    symbol: 'eth',
    image: 'https://assets.coingecko.com/coins/images/279/large/ethereum.png',
    current_price: 2890,
    price_change_percentage_24h: -1.2,
    price_change_percentage_1h_in_currency: 0.2,
    price_change_percentage_7d_in_currency: 5.4,
    market_cap: 350000000000,
    total_volume: 15000000000,
    sparkline_in_7d: { price: Array(168).fill(2800) },
  },
  {
    id: 'solana',
    market_cap_rank: 3,
    name: 'Solana',
    symbol: 'sol',
    image: 'https://assets.coingecko.com/coins/images/4128/large/solana.png',
    current_price: 185,
    price_change_percentage_24h: 3.45,
    price_change_percentage_1h_in_currency: 0.8,
    price_change_percentage_7d_in_currency: 15.2,
    market_cap: 80000000000,
    total_volume: 4500000000,
    sparkline_in_7d: { price: Array(168).fill(180) },
  },
];

=== src/lib/supabase.ts ===
// src/lib/supabase.ts
// ─── Single Supabase client for the entire app (browser-side) ────────────
import { createClient, type SupabaseClient } from '@supabase/supabase-js';

const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;
const supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;

let _supabase: SupabaseClient | null = null;

export function getSupabase(): SupabaseClient {
  if (_supabase) return _supabase;

  if (!supabaseUrl || !supabaseAnonKey) {
    console.warn(
      '[Supabase] Credentials missing. Auth features will not function.'
    );
    // Return a non-functional client so the app doesn't crash
    _supabase = createClient(
      'https://placeholder.supabase.co',
      'placeholder-key'
    );
  } else {
    _supabase = createClient(supabaseUrl, supabaseAnonKey);
  }

  return _supabase;
}

// Convenience export for components that expect `supabase` directly
export const supabase = getSupabase();

=== src/app/homepage/loading.tsx ===
export default function HomepageLoading() {
  return (
    <div className="container mx-auto px-4 lg:px-8 pt-4">
      <div className="h-[500px] bg-white/5 animate-pulse mb-8" />
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {[1, 2, 3, 4, 5, 6].map((i) => (
          <div key={i} className="h-64 bg-white/5 animate-pulse" />
        ))}
      </div>
    </div>
  );
}

=== src/app/homepage/components/HeroCarousel.tsx ===
'use client';

import React, { useState, useEffect } from 'react';
import Link from 'next/link';
import AppImage from '@/components/ui/AppImage';
import Icon from '@/components/ui/AppIcon';

interface CarouselSlide {
  id: string;
  headline: string;
  summary: string;
  image: string;
  alt: string;
  category: string;
  articleUrl: string;
}

interface HeroCarouselProps {
  slides: CarouselSlide[];
}

const HeroCarousel = ({ slides }: HeroCarouselProps) => {
  const [currentSlide, setCurrentSlide] = useState(0);
  const [isHydrated, setIsHydrated] = useState(false);

  useEffect(() => {
    setIsHydrated(true);
  }, []);

  useEffect(() => {
    if (!isHydrated) return;

    const interval = setInterval(() => {
      setCurrentSlide((prev) => (prev + 1) % slides.length);
    }, 5000);

    return () => clearInterval(interval);
  }, [isHydrated, slides.length]);

  const handlePrevious = () => {
    setCurrentSlide((prev) => (prev - 1 + slides.length) % slides.length);
  };

  const handleNext = () => {
    setCurrentSlide((prev) => (prev + 1) % slides.length);
  };

  const handleDotClick = (index: number) => {
    setCurrentSlide(index);
  };

  if (!isHydrated) {
    return (
      <div className="relative w-full h-[500px] bg-card">
        <div className="absolute inset-0 flex items-center justify-center">
          <div className="text-muted-foreground font-caption">Loading...</div>
        </div>
      </div>
    );
  }

  return (
    <div className="relative w-full h-[500px] bg-card overflow-hidden">
      {slides.map((slide, index) => (
        <div
          key={slide.id}
          className={`absolute inset-0 transition-opacity duration-500 ${
            index === currentSlide ? 'opacity-100' : 'opacity-0'
          }`}
        >
          <Link href={slide.articleUrl} className="block h-full">
            <div className="relative h-full">
              <AppImage
                src={slide.image}
                alt={slide.alt}
                fill
                className="object-cover"
                priority={index === 0}
              />
              <div className="absolute inset-0 bg-gradient-to-t from-black via-black/50 to-transparent" />
              <div className="absolute bottom-0 left-0 right-0 p-8 lg:p-12">
                <div className="max-w-4xl">
                  <span className="inline-block px-4 py-2 bg-primary text-primary-foreground text-sm font-bold font-caption mb-4">
                    {slide.category}
                  </span>
                  <h2 className="text-3xl lg:text-5xl font-bold text-white mb-4 font-heading">
                    {slide.headline}
                  </h2>
                  <p className="text-lg text-white/90 line-clamp-2">
                    {slide.summary}
                  </p>
                </div>
              </div>
            </div>
          </Link>
        </div>
      ))}

      {/* Navigation Buttons */}
      <button
        onClick={handlePrevious}
        className="absolute left-4 top-1/2 -translate-y-1/2 w-12 h-12 flex items-center justify-center bg-black/50 hover:bg-black/70 text-white transition-smooth"
        aria-label="Previous slide"
      >
        <Icon name="ChevronLeftIcon" size={24} />
      </button>

      <button
        onClick={handleNext}
        className="absolute right-4 top-1/2 -translate-y-1/2 w-12 h-12 flex items-center justify-center bg-black/50 hover:bg-black/70 text-white transition-smooth"
        aria-label="Next slide"
      >
        <Icon name="ChevronRightIcon" size={24} />
      </button>

      {/* Dots Indicator */}
      <div className="absolute bottom-4 left-1/2 -translate-x-1/2 flex items-center gap-2">
        {slides.map((_, index) => (
          <button
            key={index}
            onClick={() => handleDotClick(index)}
            className={`w-3 h-3 transition-smooth ${
              index === currentSlide ? 'bg-primary' : 'bg-white/50 hover:bg-white/70'
            }`}
            aria-label={`Go to slide ${index + 1}`}
          />
        ))}
      </div>
    </div>
  );
};

export default HeroCarousel;

=== src/app/homepage/components/HomepageInteractive.tsx ===
'use client';

import React from 'react';
import HeroCarousel from './HeroCarousel';
import NewsCard from './NewsCard';
import TrendingStories from './TrendingStories';

interface CarouselSlide {
  id: string;
  headline: string;
  summary: string;
  image: string;
  alt: string;
  category: string;
  articleUrl: string;
}

interface NewsArticle {
  id: string;
  thumbnail: string;
  alt: string;
  headline: string;
  excerpt: string;
  category: string;
  timestamp: string;
  articleUrl: string;
}

interface TrendingStory {
  id: string;
  headline: string;
  category: string;
  articleUrl: string;
  isHot: boolean;
}

interface HomepageInteractiveProps {
  carouselSlides: CarouselSlide[];
  newsArticles: NewsArticle[];
  trendingStories: TrendingStory[];
}

const HomepageInteractive = ({
  carouselSlides,
  newsArticles,
  trendingStories,
}: HomepageInteractiveProps) => {
  return (
    <div className="min-h-screen bg-background">
      {/* Hero Carousel */}
      <section className="mb-8">
        <HeroCarousel slides={carouselSlides} />
      </section>

      {/* Main Content Grid */}
      <div className="container mx-auto px-4 lg:px-8">
        <div className="grid grid-cols-1 lg:grid-cols-12 gap-8">
          {/* News Masonry Grid */}
          <div className="lg:col-span-8">
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
              {newsArticles.map((article) => (
                <NewsCard
                  key={article.id}
                  id={article.id}
                  thumbnail={article.thumbnail}
                  alt={article.alt}
                  headline={article.headline}
                  excerpt={article.excerpt}
                  category={article.category}
                  timestamp={article.timestamp}
                  articleUrl={article.articleUrl}
                />
              ))}
            </div>
          </div>

          {/* Trending Sidebar */}
          <div className="lg:col-span-4">
            <div className="sticky top-32">
              <TrendingStories stories={trendingStories} />
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

export default HomepageInteractive;

=== src/app/homepage/components/NewsCard.tsx ===
import React from 'react';
import Link from 'next/link';
import AppImage from '@/components/ui/AppImage';
import Icon from '@/components/ui/AppIcon';

interface NewsCardProps {
  id: string;
  thumbnail: string;
  alt: string;
  headline: string;
  excerpt: string;
  category: string;
  timestamp: string;
  articleUrl: string;
}

const NewsCard = ({
  id,
  thumbnail,
  alt,
  headline,
  excerpt,
  category,
  timestamp,
  articleUrl,
}: NewsCardProps) => {
  return (
    <Link href={articleUrl} className="block group">
      <article className="bg-card border border-border overflow-hidden transition-smooth hover:border-primary">
        <div className="relative h-48 overflow-hidden">
          <AppImage
            src={thumbnail}
            alt={alt}
            fill
            className="object-cover transition-smooth group-hover:scale-105"
          />
        </div>
        <div className="p-6">
          <div className="flex items-center gap-3 mb-3">
            <span className="inline-block px-3 py-1 bg-primary text-primary-foreground text-xs font-bold font-caption">
              {category}
            </span>
            <span className="text-xs text-muted-foreground font-caption">
              {timestamp}
            </span>
          </div>
          <h3 className="text-xl font-bold text-foreground mb-3 font-heading line-clamp-2 group-hover:text-primary transition-smooth">
            {headline}
          </h3>
          <p className="text-sm text-muted-foreground line-clamp-3">
            {excerpt}
          </p>
          <div className="flex items-center gap-2 mt-4 text-primary text-sm font-medium">
            <span>Read More</span>
            <Icon name="ArrowRightIcon" size={16} />
          </div>
        </div>
      </article>
    </Link>
  );
};

export default NewsCard;

=== src/app/homepage/components/TrendingStories.tsx ===
import React from 'react';
import Link from 'next/link';
import Icon from '@/components/ui/AppIcon';

interface TrendingStory {
  id: string;
  headline: string;
  category: string;
  articleUrl: string;
  isHot: boolean;
}

interface TrendingStoriesProps {
  stories: TrendingStory[];
}

const TrendingStories = ({ stories }: TrendingStoriesProps) => {
  return (
    <aside className="bg-card border border-border p-6">
      <div className="flex items-center gap-2 mb-6">
        <Icon name="FireIcon" size={24} className="text-primary" />
        <h2 className="text-2xl font-bold text-foreground font-heading">
          Trending Stories
        </h2>
      </div>
      <div className="space-y-4">
        {stories.map((story, index) => (
          <Link
            key={story.id}
            href={story.articleUrl}
            className="block group"
          >
            <article className="flex items-start gap-4 pb-4 border-b border-border last:border-b-0 last:pb-0">
              <span className="flex-shrink-0 w-8 h-8 flex items-center justify-center bg-muted text-foreground font-bold font-data text-sm">
                {index + 1}
              </span>
              <div className="flex-1 min-w-0">
                <div className="flex items-center gap-2 mb-2">
                  <span className="inline-block px-2 py-1 bg-primary text-primary-foreground text-xs font-bold font-caption">
                    {story.category}
                  </span>
                  {story.isHot && (
                    <Icon name="FireIcon" size={16} className="text-error" />
                  )}
                </div>
                <h3 className="text-sm font-medium text-foreground group-hover:text-primary transition-smooth line-clamp-2">
                  {story.headline}
                </h3>
              </div>
            </article>
          </Link>
        ))}
      </div>
      <Link
        href="/homepage"
        className="block mt-6 text-center py-3 border border-border text-foreground hover:bg-primary hover:text-primary-foreground hover:border-primary transition-smooth font-medium text-sm"
      >
        View All Trending
      </Link>
    </aside>
  );
};

export default TrendingStories;

=== src/app/homepage/error.tsx ===
'use client';

export default function HomepageError({
  error,
  reset,
}: {
  error: Error;
  reset: () => void;
}) {
  return (
    <div className="flex items-center justify-center min-h-[50vh]">
      <div className="text-center">
        <p className="text-red-500 font-mono text-xs tracking-widest uppercase mb-4">
          NEWS FEED ERROR
        </p>
        <button
          onClick={reset}
          className="bg-primary text-black font-black text-xs px-6 py-3 uppercase tracking-widest hover:bg-white transition-colors"
        >
          RETRY
        </button>
      </div>
    </div>
  );
}

=== src/app/homepage/page.tsx ===
import React from 'react';
import Breadcrumb from '@/components/common/Breadcrumb';
import HomepageInteractive from './components/HomepageInteractive';
import { getRealNews } from '@/lib/api';

export default async function Homepage({
  searchParams,
}: {
  searchParams: Promise<{ category?: string }>;
}) {
  const { category } = await searchParams;
  let news = await getRealNews();

  // Filter news if a category is selected (e.g., BTC, ETH, DEFI)
  if (category) {
    const term = category.toUpperCase();
    news = news.filter(a => 
      a.categories?.some(c => c.toUpperCase().includes(term)) || 
      a.title.toUpperCase().includes(term) ||
      a.body.toUpperCase().includes(term)
    );
  }

  const carouselSlides = news.slice(0, 3).map(a => ({
    id: a.id,
    headline: a.title,
    summary: a.body.substring(0, 150) + "...",
    image: a.image,
    alt: a.title,
    category: 'NEWS',
    articleUrl: `/news/${a.id}`,
  }));

  const newsArticles = news.slice(3).map(a => ({
    id: a.id,
    thumbnail: a.image,
    alt: a.title,
    headline: a.title,
    excerpt: a.body.substring(0, 100) + "...",
    category: a.source.toUpperCase(),
    timestamp: new Date(a.published_on * 1000).toLocaleDateString(),
    articleUrl: `/news/${a.id}`,
  }));

  const trendingStories = news.slice(0, 5).map((a, i) => ({
    id: a.id,
    headline: a.title,
    category: a.source.toUpperCase(),
    articleUrl: `/news/${a.id}`,
    isHot: i < 2,
  }));

  return (
    <div className="container mx-auto px-4 lg:px-8">
      <div className="flex justify-between items-center mb-4">
        <Breadcrumb />
        {category && (
          <span className="text-[10px] font-black bg-primary text-black px-2 py-1 uppercase tracking-widest">
            Filtering: {category}
          </span>
        )}
      </div>
      <HomepageInteractive
        carouselSlides={carouselSlides}
        newsArticles={newsArticles}
        trendingStories={trendingStories}
      />
    </div>
  );
}

=== src/app/markets-overview/loading.tsx ===
export default function MarketsLoading() {
  return (
    <div className="flex max-w-[2000px] mx-auto">
      <div className="w-64 shrink-0 hidden lg:block" />
      <main className="flex-1 p-6 md:p-8">
        <div className="h-10 w-60 bg-white/5 animate-pulse mb-6" />
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
          {[1, 2, 3, 4, 5, 6].map((i) => (
            <div key={i} className="h-40 bg-white/5 animate-pulse border border-white/5" />
          ))}
        </div>
      </main>
    </div>
  );
}

=== src/app/markets-overview/components/ETFFlowsChart.tsx ===
'use client';
import React from 'react';
import { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer } from 'recharts';

interface ETFFlowData {
  date: string;
  inflows: number;
  outflows: number;
  net: number;
}

export default function ETFFlowsChart({ data }: { data: ETFFlowData[] }) {
  // Fix: Explicitly type 'value' as number so Recharts is happy
  const formatValue = (value: number) => {
    if (value >= 1e9) return `$${(value / 1e9).toFixed(1)}B`;
    if (value >= 1e6) return `$${(value / 1e6).toFixed(1)}M`;
    return `$${(value / 1e3).toFixed(1)}K`;
  };

  return (
    <div className="w-full h-96 bg-card border border-border p-6">
      <div className="mb-6">
        <h3 className="text-lg font-bold text-foreground font-heading mb-2">Bitcoin ETF Flows</h3>
        <p className="text-sm text-muted-foreground font-caption">Daily inflows and outflows</p>
      </div>
      <ResponsiveContainer width="100%" height="100%">
        <BarChart data={data} margin={{ top: 20, right: 30, left: 20, bottom: 5 }}>
          <CartesianGrid strokeDasharray="3 3" stroke="#333333" />
          <XAxis dataKey="date" stroke="#A3A3A3" style={{ fontSize: '12px', fontFamily: 'JetBrains Mono' }} />
          <YAxis stroke="#A3A3A3" tickFormatter={formatValue} style={{ fontSize: '12px', fontFamily: 'JetBrains Mono' }} />
          <Tooltip 
            contentStyle={{ backgroundColor: '#1A1A1A', border: '1px solid #333' }}
            formatter={(value: any) => formatValue(Number(value))} 
            labelStyle={{ color: '#FFFFFF' }} 
          />
          <Legend wrapperStyle={{ fontFamily: 'JetBrains Mono', fontSize: '12px' }} />
          <Bar dataKey="inflows" fill="#22C55E" name="Inflows" />
          <Bar dataKey="outflows" fill="#EF4444" name="Outflows" />
          <Bar dataKey="net" fill="#FABF2C" name="Net Flow" />
        </BarChart>
      </ResponsiveContainer>
    </div>
  );
}

=== src/app/markets-overview/components/MarketsInteractive.tsx ===
// src/app/markets-overview/components/MarketsInteractive.tsx
'use client';

import React, { useState, useEffect } from 'react';
// FIX: Import from fallback-data directly, NOT from api.ts
import { FALLBACK_MARKET_DATA } from '@/lib/fallback-data';

export default function MarketsInteractive() {
  const [data, setData] = useState<any[]>(FALLBACK_MARKET_DATA);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const controller = new AbortController();

    fetch('/api/prices', { signal: controller.signal })
      .then((res) => {
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        return res.json();
      })
      .then((json) => {
        if (Array.isArray(json) && json.length > 0) setData(json);
      })
      .catch((err) => {
        if (err.name !== 'AbortError') {
          console.warn('[Markets] Fetch failed, using fallback');
        }
      })
      .finally(() => setLoading(false));

    return () => controller.abort();
  }, []);

  return (
    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
      {data.slice(0, 6).map((coin, index) => {
        const barWidth = `${((index + 1) * 15 + 20) % 100}%`;
        const change = coin.price_change_percentage_24h ?? 0;

        return (
          <div
            key={coin.id}
            className="bg-[#0a0a0a] border border-[#1a1a1a] p-5 hover:border-primary/30 transition-colors group"
          >
            <div className="flex justify-between items-start mb-4">
              <div className="flex items-center gap-3">
                <img
                  src={coin.image}
                  className="w-7 h-7 rounded-full grayscale group-hover:grayscale-0 transition-all"
                  alt={coin.name}
                  onError={(e) => (e.currentTarget.style.display = 'none')}
                />
                <div>
                  <h3 className="font-bold text-white text-sm">{coin.name}</h3>
                  <span className="text-[10px] text-[#555] font-mono uppercase">
                    {coin.symbol}
                  </span>
                </div>
              </div>
              <span
                className={`text-[10px] font-mono font-bold px-2 py-0.5 ${
                  change >= 0
                    ? 'bg-[#00d672]/10 text-[#00d672]'
                    : 'bg-[#ff4757]/10 text-[#ff4757]'
                }`}
              >
                {change >= 0 ? '+' : ''}
                {change.toFixed(2)}%
              </span>
            </div>
            <p className="text-xl font-black text-white font-mono tabular-nums mb-1">
              ${coin.current_price?.toLocaleString()}
            </p>
            <div className="h-0.5 w-full bg-[#111] mt-3 overflow-hidden">
              <div
                className="h-full bg-primary/50"
                style={{ width: barWidth }}
              />
            </div>
          </div>
        );
      })}
    </div>
  );
}

=== src/app/markets-overview/components/TopPerformersPanel.tsx ===
import React from 'react';
import Icon from '@/components/ui/AppIcon';

interface TopPerformer {
  symbol: string;
  name: string;
  change24h: number;
  volume24h: number;
  price: number;
}

export default function TopPerformersPanel({ performers }: { performers: TopPerformer[] }) {
  const formatPrice = (price: number) => price < 1 ? `$${price.toFixed(4)}` : `$${price.toLocaleString('en-US', { minimumFractionDigits: 2 })}`;

  return (
    <div className="bg-card border border-border p-6">
      <div className="flex items-center justify-between mb-6">
        <h3 className="text-lg font-bold text-foreground font-heading">Top Performers</h3>
        <div className="w-8 h-8 bg-primary flex items-center justify-center">
          <Icon name="FireIcon" size={16} className="text-primary-foreground" />
        </div>
      </div>
      <div className="space-y-4">
        {performers.map((performer, index) => {
          const isPositive = performer.change24h >= 0;
          return (
            <div key={performer.symbol} className="flex items-center justify-between py-3 border-b border-border last:border-b-0">
              <div className="flex items-center gap-3">
                <div className="w-8 h-8 bg-primary flex items-center justify-center">
                  <span className="text-xs font-bold text-primary-foreground font-data">{index + 1}</span>
                </div>
                <div>
                  <p className="text-sm font-bold text-foreground font-data">{performer.symbol}</p>
                  <p className="text-xs text-muted-foreground font-caption">{performer.name}</p>
                </div>
              </div>
              <div className="text-right">
                <p className="text-sm font-bold text-foreground font-data mb-1">{formatPrice(performer.price)}</p>
                <span className={`text-xs font-bold font-data ${isPositive ? 'text-success' : 'text-error'}`}>
                  {isPositive ? '+' : ''}{performer.change24h.toFixed(2)}%
                </span>
              </div>
            </div>
          );
        })}
      </div>
    </div>
  );
}

=== src/app/markets-overview/components/FuturesMarketsTable.tsx ===
import React from 'react';
import Icon from '@/components/ui/AppIcon';

interface FuturesMarket {
  id: string;
  symbol: string;
  exchange: string;
  markPrice: number;
  indexPrice: number;
  fundingRate: number;
  openInterest: number;
  volume24h: number;
  change24h: number;
}

interface FuturesMarketsTableProps {
  markets: FuturesMarket[];
  onRowClick: (market: FuturesMarket) => void;
}

export default function FuturesMarketsTable({ markets, onRowClick }: FuturesMarketsTableProps) {
  const formatPrice = (price: number) => {
    return price.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
  };

  const formatVolume = (volume: number) => {
    if (volume >= 1000000000) {
      return `$${(volume / 1000000000).toFixed(2)}B`;
    }
    if (volume >= 1000000) {
      return `$${(volume / 1000000).toFixed(2)}M`;
    }
    return `$${(volume / 1000).toFixed(2)}K`;
  };

  return (
    <div className="overflow-x-auto">
      <table className="w-full">
        <thead>
          <tr className="border-b border-border">
            <th className="text-left py-4 px-4 text-xs font-bold text-muted-foreground font-caption uppercase tracking-wide">Symbol</th>
            <th className="text-left py-4 px-4 text-xs font-bold text-muted-foreground font-caption uppercase tracking-wide">Exchange</th>
            <th className="text-right py-4 px-4 text-xs font-bold text-muted-foreground font-caption uppercase tracking-wide">Mark Price</th>
            <th className="text-right py-4 px-4 text-xs font-bold text-muted-foreground font-caption uppercase tracking-wide">Index Price</th>
            <th className="text-right py-4 px-4 text-xs font-bold text-muted-foreground font-caption uppercase tracking-wide">Funding Rate</th>
            <th className="text-right py-4 px-4 text-xs font-bold text-muted-foreground font-caption uppercase tracking-wide">Open Interest</th>
            <th className="text-right py-4 px-4 text-xs font-bold text-muted-foreground font-caption uppercase tracking-wide">24h Volume</th>
            <th className="text-right py-4 px-4 text-xs font-bold text-muted-foreground font-caption uppercase tracking-wide">24h Change</th>
          </tr>
        </thead>
        <tbody>
          {markets.map((market, index) => {
            const isPositive = market.change24h >= 0;
            const isFundingPositive = market.fundingRate >= 0;
            const isEven = index % 2 === 0;

            return (
              <tr
                key={market.id}
                onClick={() => onRowClick(market)}
                className={`border-b border-border cursor-pointer transition-smooth hover:bg-muted ${
                  isEven ? 'bg-card' : 'bg-background'
                }`}
              >
                <td className="py-4 px-4"><span className="text-sm font-bold text-foreground font-data">{market.symbol}</span></td>
                <td className="py-4 px-4"><span className="text-sm text-muted-foreground font-caption">{market.exchange}</span></td>
                <td className="py-4 px-4 text-right"><span className="text-sm font-bold text-foreground font-data">${formatPrice(market.markPrice)}</span></td>
                <td className="py-4 px-4 text-right"><span className="text-sm font-medium text-muted-foreground font-data">${formatPrice(market.indexPrice)}</span></td>
                <td className="py-4 px-4 text-right"><span className={`text-sm font-bold font-data ${isFundingPositive ? 'text-success' : 'text-error'}`}>{isFundingPositive ? '+' : ''}{(market.fundingRate * 100).toFixed(4)}%</span></td>
                <td className="py-4 px-4 text-right"><span className="text-sm font-medium text-foreground font-data">{formatVolume(market.openInterest)}</span></td>
                <td className="py-4 px-4 text-right"><span className="text-sm font-medium text-foreground font-data">{formatVolume(market.volume24h)}</span></td>
                <td className="py-4 px-4 text-right">
                  <span className={`flex items-center justify-end gap-1 text-sm font-bold font-data ${isPositive ? 'text-success' : 'text-error'}`}>
                    <Icon name={isPositive ? 'ArrowUpIcon' : 'ArrowDownIcon'} size={12} />
                    {isPositive ? '+' : ''}{market.change24h.toFixed(2)}%
                  </span>
                </td>
              </tr>
            );
          })}
        </tbody>
      </table>
    </div>
  );
}

=== src/app/markets-overview/components/VolumeAnalysisChart.tsx ===
'use client';

import React from 'react';
import { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer } from 'recharts';

interface VolumeData {
  time: string;
  spotVolume: number;
  futuresVolume: number;
  totalVolume: number;
}

export default function VolumeAnalysisChart({ data }: { data: VolumeData[] }) {
  const formatValue = (value: number) => value >= 1e9 ? `$${(value/1e9).toFixed(1)}B` : `$${(value/1e6).toFixed(1)}M`;

  return (
    <div className="w-full h-80 bg-card border border-border p-6">
      <div className="mb-6">
        <h3 className="text-lg font-bold text-foreground font-heading mb-2">24-Hour Volume Analysis</h3>
        <p className="text-sm text-muted-foreground font-caption">Trading volume breakdown across spot and futures markets</p>
      </div>
      <ResponsiveContainer width="100%" height="100%">
        <LineChart data={data} margin={{ top: 5, right: 30, left: 20, bottom: 5 }}>
          <CartesianGrid strokeDasharray="3 3" stroke="#333333" />
          <XAxis dataKey="time" stroke="#A3A3A3" style={{ fontSize: '12px', fontFamily: 'JetBrains Mono' }} />
          <YAxis stroke="#A3A3A3" tickFormatter={formatValue} style={{ fontSize: '12px', fontFamily: 'JetBrains Mono' }} />
          <Tooltip contentStyle={{ backgroundColor: '#1A1A1A', border: '1px solid #333' }} />
          <Legend />
          <Line type="monotone" dataKey="spotVolume" stroke="#22C55E" strokeWidth={2} name="Spot" dot={false} />
          <Line type="monotone" dataKey="futuresVolume" stroke="#EF4444" strokeWidth={2} name="Futures" dot={false} />
          <Line type="monotone" dataKey="totalVolume" stroke="#FABF2C" strokeWidth={3} name="Total" dot={false} />
        </LineChart>
      </ResponsiveContainer>
    </div>
  );
}

=== src/app/markets-overview/components/FilterToolbar.tsx ===
'use client';

import React from 'react';
import Icon from '@/components/ui/AppIcon';

interface FilterToolbarProps {
  selectedExchange: string;
  onExchangeChange: (exchange: string) => void;
  searchQuery: string;
  onSearchChange: (query: string) => void;
  volumeThreshold: string;
  onVolumeThresholdChange: (threshold: string) => void;
}

export default function FilterToolbar({
  selectedExchange,
  onExchangeChange,
  searchQuery,
  onSearchChange,
  volumeThreshold,
  onVolumeThresholdChange
}: FilterToolbarProps) {
  const exchanges = ['All Exchanges', 'Binance', 'Coinbase', 'Kraken', 'Bybit', 'OKX'];
  const volumeThresholds = ['All Volumes', '>$1M', '>$10M', '>$100M', '>$1B'];

  return (
    <div className="bg-card border border-border p-4 mb-6">
      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
        {/* Search Input */}
        <div className="relative">
          <div className="absolute left-3 top-1/2 -translate-y-1/2">
            <Icon name="MagnifyingGlassIcon" size={20} className="text-muted-foreground" />
          </div>
          <input
            type="text"
            value={searchQuery}
            onChange={(e) => onSearchChange(e.target.value)}
            placeholder="Search trading pairs..."
            className="w-full h-10 pl-10 pr-4 bg-background text-foreground border border-border focus:outline-none focus:ring-2 focus:ring-primary text-sm font-caption"
          />
        </div>

        {/* Exchange Filter */}
        <div className="relative">
          <select
            value={selectedExchange}
            onChange={(e) => onExchangeChange(e.target.value)}
            className="w-full h-10 px-4 bg-background text-foreground border border-border focus:outline-none focus:ring-2 focus:ring-primary text-sm font-caption appearance-none cursor-pointer"
          >
            {exchanges.map((exchange) => (
              <option key={exchange} value={exchange}>
                {exchange}
              </option>
            ))}
          </select>
          <div className="absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none">
            <Icon name="ChevronDownIcon" size={20} className="text-muted-foreground" />
          </div>
        </div>

        {/* Volume Threshold Filter */}
        <div className="relative">
          <select
            value={volumeThreshold}
            onChange={(e) => onVolumeThresholdChange(e.target.value)}
            className="w-full h-10 px-4 bg-background text-foreground border border-border focus:outline-none focus:ring-2 focus:ring-primary text-sm font-caption appearance-none cursor-pointer"
          >
            {volumeThresholds.map((threshold) => (
              <option key={threshold} value={threshold}>
                {threshold}
              </option>
            ))}
          </select>
          <div className="absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none">
            <Icon name="ChevronDownIcon" size={20} className="text-muted-foreground" />
          </div>
        </div>
      </div>
    </div>
  );
}

=== src/app/markets-overview/components/SpotMarketsTable.tsx ===
import React from 'react';
import Icon from '@/components/ui/AppIcon';

interface SpotMarket {
  id: string;
  pair: string;
  exchange: string;
  price: number;
  volume24h: number;
  change24h: number;
  bid: number;
  ask: number;
  spread: number;
}

interface SpotMarketsTableProps {
  markets: SpotMarket[];
  onRowClick: (market: SpotMarket) => void;
}

export default function SpotMarketsTable({ markets, onRowClick }: SpotMarketsTableProps) {
  const formatPrice = (price: number) => price.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
  const formatVolume = (val: number) => val >= 1e9 ? `$${(val/1e9).toFixed(2)}B` : `$${(val/1e6).toFixed(2)}M`;

  return (
    <div className="overflow-x-auto">
      <table className="w-full">
        <thead>
          <tr className="border-b border-border">
            <th className="text-left py-4 px-4 text-xs font-bold text-muted-foreground font-caption uppercase">Pair</th>
            <th className="text-left py-4 px-4 text-xs font-bold text-muted-foreground font-caption uppercase">Exchange</th>
            <th className="text-right py-4 px-4 text-xs font-bold text-muted-foreground font-caption uppercase">Price</th>
            <th className="text-right py-4 px-4 text-xs font-bold text-muted-foreground font-caption uppercase">Vol 24h</th>
            <th className="text-right py-4 px-4 text-xs font-bold text-muted-foreground font-caption uppercase">24h %</th>
          </tr>
        </thead>
        <tbody>
          {markets.map((market, index) => {
            const isPositive = market.change24h >= 0;
            return (
              <tr key={market.id} onClick={() => onRowClick(market)} className="border-b border-border cursor-pointer hover:bg-muted transition-smooth">
                <td className="py-4 px-4 font-bold font-data text-sm">{market.pair}</td>
                <td className="py-4 px-4 font-caption text-sm text-muted-foreground">{market.exchange}</td>
                <td className="py-4 px-4 text-right font-bold font-data text-sm">${formatPrice(market.price)}</td>
                <td className="py-4 px-4 text-right font-data text-sm text-muted-foreground">{formatVolume(market.volume24h)}</td>
                <td className={`py-4 px-4 text-right font-bold font-data text-sm ${isPositive ? 'text-success' : 'text-error'}`}>
                  {isPositive ? '+' : ''}{market.change24h}%
                </td>
              </tr>
            );
          })}
        </tbody>
      </table>
    </div>
  );
}

=== src/app/markets-overview/components/MarketSummaryCard.tsx ===
import React from 'react';
import Icon from '@/components/ui/AppIcon';

interface MarketSummaryCardProps {
  title: string;
  value: string;
  change: number;
  changePercent: number;
  icon: string;
}

export default function MarketSummaryCard({ title, value, change, changePercent, icon }: MarketSummaryCardProps) {
  const isPositive = change >= 0;

  return (
    <div className="bg-card border border-border p-6">
      <div className="flex items-start justify-between mb-4">
        <div className="flex items-center gap-3">
          <div className="w-10 h-10 bg-primary flex items-center justify-center">
            <Icon name={icon as any} size={20} className="text-primary-foreground" />
          </div>
          <h3 className="text-sm font-medium text-muted-foreground font-caption uppercase tracking-wide">{title}</h3>
        </div>
      </div>
      <div className="space-y-2">
        <p className="text-2xl font-bold text-foreground font-data">{value}</p>
        <div className="flex items-center gap-2">
          <span className={`flex items-center gap-1 text-xs font-medium font-data ${isPositive ? 'text-success' : 'text-error'}`}>
            <Icon name={isPositive ? 'ArrowUpIcon' : 'ArrowDownIcon'} size={12} />
            {isPositive ? '+' : ''}{changePercent.toFixed(2)}%
          </span>
        </div>
      </div>
    </div>
  );
}

=== src/app/markets-overview/page.tsx ===
import React from 'react';
import { DataSidebar } from '@/app/data/_components/DataSidebar';
import MarketsInteractive from './components/MarketsInteractive';

export default function MarketsOverviewPage() {
  return (
    <div className="flex max-w-[2000px] mx-auto border-l border-r border-[#1a1a1a]">
      <DataSidebar />
      <main className="flex-1 min-w-0 bg-[#050505] p-6 md:p-8">
        <div className="mb-8">
          <h1 className="text-4xl font-black font-heading uppercase tracking-tighter mb-2">
            Market <span className="text-primary">Overview</span>
          </h1>
          <div className="h-px w-20 bg-primary/40 mt-2" />
        </div>
        <MarketsInteractive />
      </main>
    </div>
  );
}

=== src/app/data/defi/tvl/page.tsx ===
import React from 'react';
import { getDeFiProtocols } from '@/lib/api';

export default async function TVLPage() {
  const protocols = await getDeFiProtocols();
  
  return (
    <div className="space-y-6">
      <h1 className="text-3xl font-black text-white font-heading uppercase">TVL <span className="text-primary">Rankings</span></h1>
      <div className="grid grid-cols-1 gap-2">
        {protocols.map((p, i) => (
          <div key={i} className="flex items-center justify-between p-4 bg-[#0a0a0a] border border-[#1a1a1a] hover:border-primary/50 transition-all">
            <div className="flex items-center gap-4">
              <span className="text-[#333] font-mono text-xs">#{(i + 1).toString().padStart(2, '0')}</span>
              <span className="font-bold text-white uppercase">{p.name}</span>
            </div>
            <span className="font-mono text-primary">${p.tvl?.toLocaleString()}</span>
          </div>
        ))}
      </div>
    </div>
  );
}

=== src/app/data/defi/whale-watch/loading.tsx ===
export default function WhaleWatchLoading() {
  return (
    <div className="space-y-8 animate-pulse">
      <div>
        <div className="h-8 w-64 bg-white/5 mb-2" />
        <div className="h-4 w-48 bg-white/5" />
      </div>

      <div className="grid grid-cols-2 lg:grid-cols-4 gap-4">
        {[1, 2, 3, 4].map((i) => (
          <div key={i} className="h-24 bg-white/5 border border-white/5" />
        ))}
      </div>

      <div className="bg-white/5 border border-white/5 h-[600px]" />
    </div>
  );
}

=== src/app/data/defi/whale-watch/error.tsx ===
'use client';

export default function WhaleWatchError({
  error,
  reset,
}: {
  error: Error;
  reset: () => void;
}) {
  return (
    <div className="min-h-[50vh] flex flex-col items-center justify-center text-center p-6 border border-[#1a1a1a] bg-[#0a0a0a]">
      <div className="text-4xl mb-4">🐋</div>
      <h3 className="text-xl font-bold font-heading text-white mb-2">
        Data Stream Interrupted
      </h3>
      <p className="text-sm text-[#666] font-mono mb-6 max-w-md">
        The on-chain feed is currently unresponsive. This is often due to Dune Analytics rate limits or timeouts.
      </p>
      <button
        onClick={reset}
        className="bg-primary text-black font-black text-xs px-6 py-3 uppercase tracking-widest hover:bg-white transition-colors"
      >
        Retry Connection
      </button>
    </div>
  );
}

=== src/app/data/defi/whale-watch/page.tsx ===
import { getWhaleTransfers } from '@/lib/dune';
import { MetricCard } from '../../_components/MetricCard';

export const metadata = { title: '🐋 Whale Watch' };

function shortenAddress(addr: string): string {
  if (!addr || addr.length < 10) return addr || '—';
  return `${addr.slice(0,6)}…${addr.slice(-4)}`;
}

function formatUsd(value: number): string {
  if (value >= 1_000_000) return `$${(value / 1_000_000).toFixed(1)}M`;
  if (value >= 1_000) return `$${(value / 1_000).toFixed(0)}K`;
  return `$${value.toFixed(0)}`;
}

export default async function WhaleWatchPage() {
  const transfers = await getWhaleTransfers();
  const totalVolume = transfers.reduce((s, t) => s + (t.usd_value || 0), 0);
  const uniqueWhales = new Set(transfers.map(t => t.sender)).size;

  return (
    <div className="space-y-8">
      <div>
        <h1 className="text-3xl font-black text-foreground font-heading mb-1">🐋 Whale <span className="text-primary">Watch</span></h1>
        <p className="text-sm text-muted-foreground font-caption">Large on‑chain transfers (last 24h)</p>
      </div>

      <div className="grid grid-cols-2 lg:grid-cols-4 gap-4">
        <MetricCard label="Transfers" value={String(transfers.length)} />
        <MetricCard label="Total Volume" value={formatUsd(totalVolume)} />
        <MetricCard label="Unique Whales" value={String(uniqueWhales)} />
        <MetricCard label="Data Source" value="Dune" />
      </div>

      {transfers.length === 0 ? (
        <div className="bg-card border border-border p-12 text-center text-muted-foreground">
          <div className="text-4xl mb-4">🐋</div>
          <p>No whale transfers found. Dune API key may not be configured.</p>
        </div>
      ) : (
        <div className="bg-card border border-border overflow-hidden">
          <div className="overflow-x-auto">
            <table className="w-full text-left">
              <thead className="bg-secondary/50 text-xs text-muted-foreground uppercase tracking-wider font-caption">
                <tr>
                  <th className="px-6 py-3">Time</th><th className="px-6 py-3">Token</th><th className="px-6 py-3">From</th>
                  <th className="px-6 py-3">To</th><th className="px-6 py-3 text-right">Amount</th>
                  <th className="px-6 py-3 text-right">USD Value</th><th className="px-6 py-3">Tx</th>
                </tr>
              </thead>
              <tbody className="divide-y divide-border">
                {transfers.slice(0, 50).map((tx, i) => (
                  <tr key={`${tx.tx_hash}-${i}`} className="hover:bg-primary/5 transition-colors">
                    <td className="px-6 py-3 text-xs text-muted-foreground font-data whitespace-nowrap">
                      {new Date(tx.block_time).toLocaleTimeString('en-US', { hour:'2-digit', minute:'2-digit' })}
                    </td>
                    <td className="px-6 py-3 text-sm font-semibold text-foreground">{tx.token_symbol || 'ETH'}</td>
                    <td className="px-6 py-3 text-xs font-data text-muted-foreground">
                      <a href={`https://etherscan.io/address/${tx.sender}`} target="_blank" rel="noopener" className="hover:text-primary">{shortenAddress(tx.sender)}</a>
                    </td>
                    <td className="px-6 py-3 text-xs font-data text-muted-foreground">
                      <a href={`https://etherscan.io/address/${tx.receiver}`} target="_blank" rel="noopener" className="hover:text-primary">{shortenAddress(tx.receiver)}</a>
                    </td>
                    <td className="px-6 py-3 text-sm text-right font-data text-foreground">
                      {tx.amount?.toLocaleString(undefined, { maximumFractionDigits: 2 }) || '—'}
                    </td>
                    <td className="px-6 py-3 text-sm text-right font-data font-bold text-primary">
                      {formatUsd(tx.usd_value)}
                    </td>
                    <td className="px-6 py-3 text-xs">
                      <a href={`https://etherscan.io/tx/${tx.tx_hash}`} target="_blank" rel="noopener" className="text-primary hover:underline font-data">View ↗</a>
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        </div>
      )}
    </div>
  );
}

=== src/app/data/defi/yields/page.tsx ===
import React from 'react';
import { MetricCard } from '../../_components/MetricCard';

export default function YieldsPage() {
  return (
    <div className="space-y-8">
      <h1 className="text-3xl font-black text-white font-heading uppercase tracking-tighter">Yield <span className="text-primary">Aggregator</span></h1>
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
        <MetricCard label="USDC Yield (Avg)" value="5.2%" trend={0.4} />
        <MetricCard label="ETH Staking" value="3.8%" />
        <MetricCard label="Highest APY" value="124%" />
        <MetricCard label="Risk Level" value="STABLE" />
      </div>
      <div className="p-20 border-2 border-dashed border-[#1a1a1a] rounded text-center text-[#333] font-mono text-xs uppercase tracking-[0.5em]">
        Yield opportunity scanner initializing...
      </div>
    </div>
  );
}

=== src/app/data/defi/large-swaps/loading.tsx ===
export default function LargeSwapsLoading() {
  return (
    <div className="space-y-8 animate-pulse">
      <div>
        <div className="h-8 w-64 bg-white/5 mb-2" />
        <div className="h-4 w-48 bg-white/5" />
      </div>
      <div className="grid grid-cols-2 lg:grid-cols-4 gap-4">
        {[1, 2, 3, 4].map((i) => (
          <div key={i} className="h-24 bg-white/5 border border-white/5" />
        ))}
      </div>
      <div className="bg-white/5 border border-white/5 h-[600px]" />
    </div>
  );
}

=== src/app/data/defi/large-swaps/page.tsx ===
import { getLargeDexSwaps } from '@/lib/dune';
import { MetricCard } from '../../_components/MetricCard';

export const metadata = { title: 'Large DEX Swaps' };

function formatUsd(val: number) {
  if (!val) return '$0';
  return val >= 1e6 
    ? `$${(val / 1e6).toFixed(2)}M` 
    : `$${(val / 1e3).toFixed(0)}K`;
}

export default async function LargeSwapsPage() {
  const swaps = await getLargeDexSwaps();
  
  // Calculate aggregate stats from the last batch
  const totalVolume = swaps.reduce((acc, s) => acc + (s.usd_amount || 0), 0);
  const avgSwap = swaps.length > 0 ? totalVolume / swaps.length : 0;
  
  // Find top active pair
  const pairCounts: Record<string, number> = {};
  swaps.forEach(s => {
    const pair = `${s.token_a_symbol}/${s.token_b_symbol}`;
    pairCounts[pair] = (pairCounts[pair] || 0) + 1;
  });
  const topPair = Object.entries(pairCounts).sort((a, b) => b[1] - a[1])[0]?.[0] || '—';

  return (
    <div className="space-y-8">
      <div>
        <h1 className="text-3xl font-black text-foreground font-heading mb-1">
          DEX <span className="text-primary">Flow</span>
        </h1>
        <p className="text-sm text-muted-foreground font-caption">
          Live trades &gt; $100k on Uniswap, Curve, Balancer
        </p>
      </div>

      <div className="grid grid-cols-2 lg:grid-cols-4 gap-4">
        <MetricCard label="24h Volume (Sample)" value={formatUsd(totalVolume)} />
        <MetricCard label="Avg Trade Size" value={formatUsd(avgSwap)} />
        <MetricCard label="Top Active Pair" value={topPair} />
        <MetricCard label="Source" value="Dune Dex.Trades" />
      </div>

      <div className="bg-card border border-border overflow-hidden">
        <div className="overflow-x-auto">
          <table className="w-full text-left">
            <thead className="bg-secondary/50 text-xs text-muted-foreground uppercase tracking-wider font-caption">
              <tr>
                <th className="px-6 py-3">Time</th>
                <th className="px-6 py-3">DEX</th>
                <th className="px-6 py-3">Pair</th>
                <th className="px-6 py-3 text-right">Value (USD)</th>
                <th className="px-6 py-3 text-right">Action</th>
                <th className="px-6 py-3 text-center">Tx</th>
              </tr>
            </thead>
            <tbody className="divide-y divide-border">
              {swaps.map((swap, i) => (
                <tr key={`${swap.tx_hash}-${i}`} className="hover:bg-primary/5 transition-colors group">
                  <td className="px-6 py-3 text-xs text-muted-foreground font-data whitespace-nowrap">
                    {new Date(swap.block_time).toLocaleTimeString([], { hour: '2-digit', minute:'2-digit' })}
                  </td>
                  <td className="px-6 py-3 text-sm font-bold text-foreground capitalize">
                    {swap.project}
                  </td>
                  <td className="px-6 py-3 text-xs font-data text-muted-foreground">
                    <span className="text-foreground font-bold">{swap.token_a_symbol}</span>
                    <span className="mx-1 text-[#444]">/</span>
                    <span>{swap.token_b_symbol}</span>
                  </td>
                  <td className="px-6 py-3 text-sm text-right font-data font-bold text-primary">
                    {formatUsd(swap.usd_amount)}
                  </td>
                  <td className="px-6 py-3 text-right text-xs font-mono text-muted-foreground">
                    <span className="text-success">SWAP</span>
                  </td>
                  <td className="px-6 py-3 text-center">
                    <a 
                      href={`https://etherscan.io/tx/${swap.tx_hash}`} 
                      target="_blank" 
                      rel="noopener"
                      className="text-[#444] hover:text-white transition-colors"
                    >
                      ↗
                    </a>
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  );
}

=== src/app/data/defi/page.tsx ===
import React from 'react';
import { getDeFiProtocols } from '@/lib/api';
import { MetricCard } from '../_components/MetricCard';

export default async function DeFiOverviewPage() {
  const protocols = await getDeFiProtocols();
  const totalTVL = protocols.reduce((sum, p) => sum + (p.tvl || 0), 0);

  return (
    <div className="space-y-8">
      <div>
        <h1 className="text-3xl font-black text-white font-heading uppercase tracking-tighter">
          DeFi <span className="text-primary">Intelligence</span>
        </h1>
        <p className="text-[#444] font-mono text-[10px] uppercase tracking-[0.3em] mt-1">Institutional Protocol Analytics</p>
      </div>

      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
        <MetricCard label="Global DeFi TVL" value={`$${(totalTVL / 1e9).toFixed(2)}B`} />
        <MetricCard label="Active Protocols" value={String(protocols.length)} />
        <MetricCard label="Market State" value="EXPANDING" />
      </div>

      <div className="border border-[#1a1a1a] bg-[#080808] overflow-hidden">
        <table className="w-full text-left border-collapse">
          <thead>
            <tr className="border-b border-[#1a1a1a] bg-[#0a0a0a]">
              <th className="px-6 py-3 text-[10px] font-black text-[#444] uppercase tracking-widest">Protocol</th>
              <th className="px-6 py-3 text-[10px] font-black text-[#444] uppercase tracking-widest">Category</th>
              <th className="px-6 py-3 text-[10px] font-black text-[#444] uppercase tracking-widest text-right">TVL</th>
            </tr>
          </thead>
          <tbody>
            {protocols.slice(0, 10).map((p, i) => (
              <tr key={i} className="border-b border-[#111] hover:bg-white/5 transition-colors">
                <td className="px-6 py-4 font-bold text-white text-sm">{p.name}</td>
                <td className="px-6 py-4 text-[#666] text-xs uppercase font-mono">{p.category}</td>
                <td className="px-6 py-4 text-right font-mono text-primary text-sm">${(p.tvl / 1e6).toFixed(1)}M</td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>
    </div>
  );
}

=== src/app/data/defi/stablecoins/page.tsx ===
import React from 'react';
import { getStablecoinData } from '@/lib/api';
import { MetricCard } from '../../_components/MetricCard';

export default async function StablecoinsPage() {
  const data = await getStablecoinData();
  const currentMcap = data[data.length - 1]?.mcap || 0;

  return (
    <div className="space-y-8">
      <div>
        <h1 className="text-3xl font-black text-white font-heading uppercase tracking-tighter">
          Stablecoin <span className="text-primary">Intelligence</span>
        </h1>
        <p className="text-[#444] font-mono text-[10px] uppercase tracking-[0.3em] mt-1">Aggregate Market Cap & Liquidity Flows</p>
      </div>

      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
        <MetricCard label="Total Circulating" value={`$${(currentMcap / 1e9).toFixed(2)}B`} />
        <MetricCard label="Dominance" value="72.4%" />
        <MetricCard label="Data Source" value="DefiLlama" />
      </div>

      <div className="border border-[#1a1a1a] bg-[#080808] p-8 text-center">
        <p className="text-[#333] font-mono text-xs uppercase tracking-widest italic">Chart Visualization Module Loading...</p>
      </div>
    </div>
  );
}

=== src/app/data/layout.tsx ===
import React from 'react';
import { DataSidebar } from './_components/DataSidebar';
import { DataBreadcrumb } from './_components/DataBreadcrumb';

export default function DataTerminalLayout({ children }: { children: React.ReactNode }) {
  return (
    <div className="flex max-w-[2000px] mx-auto border-x border-[#1a1a1a] min-h-screen">
      <DataSidebar />
      <main className="flex-1 min-w-0 bg-[#050505] p-6 lg:p-10">
        <DataBreadcrumb />
        {children}
      </main>
    </div>
  );
}

=== src/app/data/onchain/page.tsx ===
import React from 'react';
import { MetricCard } from '../_components/MetricCard';

export default function OnChainPage() {
  return (
    <div className="space-y-8">
      <h1 className="text-3xl font-black text-white font-heading uppercase">On-Chain <span className="text-primary">Metrics</span></h1>
      <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
        <MetricCard label="ETH Gas" value="14 Gwei" />
        <MetricCard label="Active Addr" value="452K" trend={2.4} />
        <MetricCard label="Daily Tx" value="1.1M" />
        <MetricCard label="Burned ETH" value="2.1K" />
      </div>
      <div className="h-64 border border-[#1a1a1a] bg-[#0a0a0a] flex items-center justify-center text-[#222] font-black text-4xl">NETWORK ACTIVITY</div>
    </div>
  );
}

=== src/app/data/market/page.tsx ===
import React from 'react';
import { getLivePrices } from '@/lib/api';

export default async function MarketOverviewPage() {
  const prices = await getLivePrices();
  return (
    <div className="space-y-6">
      <h1 className="text-3xl font-black text-white font-heading uppercase tracking-tighter">Market <span className="text-primary">Data</span></h1>
      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
        {prices.slice(0, 4).map(coin => (
          <div key={coin.id} className="p-6 border border-[#1a1a1a] bg-[#080808] flex justify-between items-center">
            <span className="font-bold text-white uppercase">{coin.symbol}</span>
            <span className="font-mono text-primary">${coin.current_price.toLocaleString()}</span>
          </div>
        ))}
      </div>
    </div>
  );
}

=== src/app/data/page.tsx ===
import { redirect } from 'next/navigation';

export default function DataRoot() {
  redirect('/markets-overview');
}

=== src/app/data/_components/DataBreadcrumb.tsx ===
'use client';
import { usePathname } from 'next/navigation';
import Link from 'next/link';

const LABELS: Record<string, string> = {
  data: 'Terminal',
  defi: 'DeFi',
  tvl: 'TVL',
  yields: 'Yields',
  stablecoins: 'Stablecoins',
  'whale-watch': 'Whale Watch',
  market: 'Market',
  spot: 'Spot',
  futures: 'Futures',
  volumes: 'Volumes',
  etfs: 'ETFs',
  bitcoin: 'Bitcoin',
  ethereum: 'Ethereum',
  onchain: 'On‑Chain',
  gas: 'Gas',
  addresses: 'Addresses',
};

export function DataBreadcrumb() {
  const pathname = usePathname();
  const segments = pathname.split('/').filter(Boolean);
  return (
    <nav className="flex items-center gap-1.5 text-xs text-muted-foreground font-caption mb-6">
      {segments.map((segment, idx) => {
        const href = '/' + segments.slice(0, idx + 1).join('/');
        const isLast = idx === segments.length - 1;
        const label = LABELS[segment] || segment;
        return (
          <span key={href} className="flex items-center gap-1.5">
            {idx > 0 && <span className="text-border">/</span>}
            {isLast ? (
              <span className="text-foreground font-semibold">{label}</span>
            ) : (
              <Link href={href} className="hover:text-primary transition-colors">{label}</Link>
            )}
          </span>
        );
      })}
    </nav>
  );
}

=== src/app/data/_components/DataSidebar.tsx ===
'use client';
import { usePathname } from 'next/navigation';
import Link from 'next/link';
import { useState } from 'react';
import Icon from '@/components/ui/AppIcon';

const SECTIONS = [
  {
    label: 'Market',
    icon: 'ChartBarIcon',
    children: [
      { label: 'Overview', href: '/data/market' },
      { label: 'Spot', href: '/data/market/spot' },
      { label: 'Futures', href: '/data/market/futures' },
      { label: 'Volumes', href: '/data/market/volumes' },
    ],
  },
  {
    label: 'ETFs',
    icon: 'BanknotesIcon',
    children: [
      { label: 'Overview', href: '/data/etfs' },
      { label: 'Bitcoin ETFs', href: '/data/etfs/bitcoin' },
      { label: 'Ethereum ETFs', href: '/data/etfs/ethereum' },
    ],
  },
  {
    label: 'DeFi',
    icon: 'CircleStackIcon',
    children: [
      { label: 'Overview', href: '/data/defi' },
      { label: 'TVL', href: '/data/defi/tvl' },
      { label: 'Yields', href: '/data/defi/yields' },
      { label: 'Stablecoins', href: '/data/defi/stablecoins' },
      { label: '🐋 Whale Watch', href: '/data/defi/whale-watch' },
    ],
  },
  {
    label: 'On‑Chain',
    icon: 'CubeTransparentIcon',
    children: [
      { label: 'Overview', href: '/data/onchain' },
      { label: 'Gas Tracker', href: '/data/onchain/gas' },
      { label: 'Active Addresses', href: '/data/onchain/addresses' },
    ],
  },
];

export function DataSidebar() {
  const pathname = usePathname();
  return (
    <aside className="w-64 shrink-0 border-r border-[#222] bg-black min-h-screen sticky top-16 self-start hidden lg:block">
      <div className="p-4">
        <div className="text-[10px] font-black text-gray-500 uppercase tracking-[0.2em] mb-6 font-mono">Data Terminal</div>
        <nav className="space-y-1">
          {SECTIONS.map((section) => (
            <SectionGroup key={section.label} section={section} pathname={pathname} />
          ))}
        </nav>
      </div>
    </aside>
  );
}

function SectionGroup({ section, pathname }: { section: typeof SECTIONS[0]; pathname: string }) {
  const isActive = section.children.some(c => pathname === c.href || pathname.startsWith(c.href + '/'));
  const [open, setOpen] = useState(isActive);
  return (
    <div className="mb-2">
      <button onClick={() => setOpen(!open)} className={`w-full flex items-center justify-between px-3 py-2 text-xs font-bold text-gray-300 hover:text-white hover:bg-white/5 rounded transition-colors uppercase tracking-wide ${isActive ? 'bg-white/10 text-white' : ''}`}>
        <span className="flex items-center gap-2">
          <Icon name={section.icon as any} size={14} className="text-primary" />
          {section.label}
        </span>
        <Icon name={open ? 'ChevronDownIcon' : 'ChevronRightIcon'} size={12} />
      </button>
      {open && (
        <div className="ml-4 mt-1 space-y-0.5 border-l border-[#333] pl-3">
          {section.children.map((item) => {
            const isItemActive = pathname === item.href;
            return (
              <Link key={item.href} href={item.href} className={`block px-3 py-1.5 text-[11px] font-medium rounded transition-colors ${
                isItemActive ? 'text-primary bg-primary/10 border-r-2 border-primary' : 'text-gray-500 hover:text-white'
              }`}>
                {item.label}
              </Link>
            );
          })}
        </div>
      )}
    </div>
  );
}

=== src/app/data/_components/MetricCard.tsx ===
import React from 'react';

interface MetricCardProps {
  label: string;
  value: string;
  trend?: number;
}

export function MetricCard({ label, value, trend }: MetricCardProps) {
  return (
    <div className="bg-card border border-border p-4 flex flex-col justify-between h-full hover:border-primary/50 transition-colors">
      <span className="text-xs font-bold text-muted-foreground uppercase tracking-wider font-caption">
        {label}
      </span>
      <div className="mt-2 flex items-end justify-between">
        <span className="text-2xl font-black text-foreground font-data tabular-nums">
          {value}
        </span>
        {trend !== undefined && (
          <span className={`text-xs font-bold font-mono ${trend >= 0 ? 'text-success' : 'text-error'}`}>
            {trend > 0 ? '+' : ''}{trend}%
          </span>
        )}
      </div>
    </div>
  );
}

=== src/app/diagnostic/page.tsx ===
export default function DiagnosticPage() {
  return <div className="p-20 text-white font-mono">DIAGNOSTIC OK: SYSTEM IS RENDERING</div>;
}

=== src/app/layout.tsx ===
import React, { Suspense } from 'react';
import type { Metadata } from 'next';
import { Merriweather, Inter, JetBrains_Mono, Space_Mono } from 'next/font/google';
import '../styles/globals.css';
import Header from '@/components/common/Header';
import PriceTicker from '@/components/common/PriceTicker';
import Footer from '@/components/layout/Footer';

const merriweather = Merriweather({ subsets: ['latin'], weight: ['400', '700', '900'], variable: '--font-heading', display: 'swap' });
const inter = Inter({ subsets: ['latin'], weight: ['400', '500', '700'], variable: '--font-body', display: 'swap' });
const jetbrains = JetBrains_Mono({ subsets: ['latin'], variable: '--font-caption', display: 'swap' });
const space = Space_Mono({ subsets: ['latin'], weight: ['400', '700'], variable: '--font-data', display: 'swap' });

export const metadata: Metadata = { 
  title: 'CryptoBrainNews | Institutional Terminal',
  description: 'Institutional-grade crypto intelligence.'
};

export default function RootLayout({ children }: { children: React.ReactNode }) {
  return (
    <html lang="en" className={`${merriweather.variable} ${inter.variable} ${jetbrains.variable} ${space.variable}`}>
      <body className="bg-black text-white min-h-screen flex flex-col antialiased">
        <Header />
        <PriceTicker />
        <main className="flex-grow pt-[calc(4rem+2.5rem)]">
          <Suspense fallback={
            <div className="flex items-center justify-center h-[50vh]">
              <div className="text-primary font-mono text-xs animate-pulse uppercase tracking-[0.3em]">
                SYNCING DATA...
              </div>
            </div>
          }>
            {children}
          </Suspense>
        </main>
        <Footer />
      </body>
    </html>
  );
}

=== src/app/auth/callback/page.tsx ===
'use client';
import { useEffect } from 'react';
import { useRouter } from 'next/navigation';
import { supabase } from '@/lib/supabase' ; 

export default function AuthCallbackPage() {
  const router = useRouter();

  useEffect(() => {
    // Supabase client automatically detects the #access_token hash in the URL
    // We listen for the SIGNED_IN event to know when it's safe to redirect
    const { data: { subscription } } = supabase.auth.onAuthStateChange((event, session) => {
      if (event === 'SIGNED_IN' || session) {
        // Successful login! Redirect to the DeFi page to see the unlocked charts
        router.push('/de-fi-analytics');
      }
    });

    return () => subscription.unsubscribe();
  }, [router]);

  return (
    <div className="min-h-screen bg-black flex flex-col items-center justify-center text-white">
      <div className="animate-spin h-12 w-12 border-4 border-primary border-t-transparent rounded-full mb-6"></div>
      <h1 className="text-2xl font-bold font-heading mb-2">VERIFYING CREDENTIALS</h1>
      <p className="text-gray-500 font-mono text-xs uppercase tracking-widest">Establishing Secure Session...</p>
    </div>
  );
}

=== src/app/de-fi-analytics/loading.tsx ===
// src/app/de-fi-analytics/loading.tsx
export default function DeFiLoading() {
  return (
    <div className="flex max-w-[2000px] mx-auto">
      <div className="w-64 shrink-0 hidden lg:block" />
      <main className="flex-1 p-6 md:p-8">
        <div className="h-10 w-80 bg-white/5 animate-pulse mb-8" />
        <div className="grid grid-cols-1 lg:grid-cols-12 gap-8">
          <div className="lg:col-span-8 h-96 bg-white/5 animate-pulse border border-white/5" />
          <div className="lg:col-span-4 h-96 bg-white/5 animate-pulse border border-white/5" />
        </div>
      </main>
    </div>
  );
}

=== src/app/de-fi-analytics/components/YieldCalculator.tsx ===
'use client';
import React, { useState } from 'react';
import Icon from '@/components/ui/AppIcon';

const YieldCalculator = () => {
  const [amount, setAmount] = useState(10000);
  const apy = 12.5;

  return (
    <div className="bg-card border border-border p-6">
      <h2 className="text-xl font-bold font-heading mb-4">Yield Optimizer</h2>
      <div className="space-y-4">
        <div>
          <label className="text-xs font-caption text-muted-foreground uppercase">Investment Amount (USD)</label>
          <input 
            type="number" 
            value={amount} 
            onChange={(e) => setAmount(Number(e.target.value))}
            className="w-full bg-secondary border border-border p-3 text-white font-data mt-1 outline-none focus:border-primary"
          />
        </div>
        <div className="bg-secondary p-4 flex justify-between items-center">
          <div>
            <p className="text-xs font-caption text-muted-foreground">Estimated Yearly Return</p>
            <p className="text-2xl font-bold text-success font-data">${(amount * (apy/100)).toLocaleString()}</p>
          </div>
          <Icon name="ArrowTrendingUpIcon" className="text-success" size={32} />
        </div>
      </div>
    </div>
  );
};
export default YieldCalculator;

=== src/app/de-fi-analytics/components/StablecoinAnalytics.tsx ===
'use client';
import React from 'react';
import { PieChart, Pie, Cell, ResponsiveContainer, Legend, Tooltip } from 'recharts';

interface StablecoinAnalyticsProps {
  data: any[];
}

const StablecoinAnalytics = ({ data }: StablecoinAnalyticsProps) => {
  const COLORS = ['#FABF2C', '#627EEA', '#26A17B', '#F3BA2F', '#002868'];
  
  const chartData = data.map((s, i) => ({
    name: s.symbol,
    value: s.circulating,
  }));

  return (
    <div className="bg-card border border-border p-6">
      <h2 className="text-xl font-bold font-heading mb-4 text-primary uppercase tracking-widest">Stablecoin Dominance</h2>
      <div className="w-full h-[300px]">
        <ResponsiveContainer width="100%" height="100%">
          <PieChart>
            <Pie data={chartData} innerRadius={60} outerRadius={80} paddingAngle={5} dataKey="value">
              {chartData.map((entry, index) => (
                <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />
              ))}
            </Pie>
            <Tooltip />
            <Legend />
          </PieChart>
        </ResponsiveContainer>
      </div>
    </div>
  );
};
export default StablecoinAnalytics;

=== src/app/de-fi-analytics/components/OnChainMetrics.tsx ===
'use client';
import React from 'react';
import { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer } from 'recharts';
import Icon from '@/components/ui/AppIcon';

const OnChainMetrics = () => {
  const mockMetricsData = [
    { date: '2026-01-21', transactions: 1250000, uniqueUsers: 345000 },
    { date: '2026-01-22', transactions: 1320000, uniqueUsers: 367000 },
    { date: '2026-01-23', transactions: 1180000, uniqueUsers: 328000 },
    { date: '2026-01-24', transactions: 1450000, uniqueUsers: 389000 },
    { date: '2026-01-25', transactions: 1560000, uniqueUsers: 412000 },
    { date: '2026-01-26', transactions: 1420000, uniqueUsers: 395000 },
    { date: '2026-01-27', transactions: 1680000, uniqueUsers: 445000 }
  ];

  return (
    <div className="bg-card border border-border p-6">
      <h2 className="text-xl font-bold font-heading mb-4 text-primary uppercase tracking-widest">Network Activity</h2>
      <div className="w-full h-[250px]">
        <ResponsiveContainer width="100%" height="100%">
          <BarChart data={mockMetricsData}>
            <CartesianGrid strokeDasharray="3 3" stroke="#333" vertical={false} />
            <XAxis dataKey="date" stroke="#666" fontSize={10} tickFormatter={(val) => val.split('-')[2]} />
            <YAxis stroke="#666" fontSize={10} />
            <Tooltip contentStyle={{backgroundColor: '#000', borderColor: '#FABF2C'}} />
            <Bar dataKey="transactions" fill="#FABF2C" radius={[2, 2, 0, 0]} />
          </BarChart>
        </ResponsiveContainer>
      </div>
    </div>
  );
};
export default OnChainMetrics;

=== src/app/de-fi-analytics/components/WhaleWatch.tsx ===
'use client';
import React from 'react';
import { AreaChart, Area, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer } from 'recharts';
import Icon from '@/components/ui/AppIcon';

const DATA = [
  { time: '00:00', inflow: 400, net: 240 },
  { time: '04:00', inflow: 300, net: 139 },
  { time: '08:00', inflow: 900, net: 980 }, // WHALE MOVE
  { time: '12:00', inflow: 200, net: 390 },
  { time: '16:00', inflow: 278, net: 480 },
  { time: '20:00', inflow: 189, net: 480 },
];

export default function WhaleWatch() {
  return (
    <div className="bg-[#0a0a0a] border-2 border-primary/20 p-6 shadow-[0_0_50px_rgba(250,191,44,0.05)]">
      <div className="flex justify-between items-start mb-8">
        <div>
          <div className="flex items-center gap-2 mb-1">
            <span className="w-2 h-2 bg-primary animate-pulse rounded-full"></span>
            <h3 className="text-white font-black text-xs uppercase tracking-[0.3em]">Whale Liquidity Tracker</h3>
          </div>
          <p className="text-[10px] text-gray-500 font-mono">ON-CHAIN SIGNAL: SOLANA / ETH BRIDGE</p>
        </div>
        <div className="bg-primary text-black text-[9px] font-black px-2 py-1 uppercase italic">Live Signal</div>
      </div>

      <div className="h-[250px] w-full">
        <ResponsiveContainer width="100%" height="100%">
          <AreaChart data={DATA}>
            <defs>
              <linearGradient id="colorNet" x1="0" y1="0" x2="0" y2="1">
                <stop offset="5%" stopColor="#FABF2C" stopOpacity={0.3}/>
                <stop offset="95%" stopColor="#FABF2C" stopOpacity={0}/>
              </linearGradient>
            </defs>
            <CartesianGrid strokeDasharray="3 3" stroke="#1a1a1a" vertical={false} />
            <XAxis dataKey="time" stroke="#333" fontSize={10} font-family="monospace" />
            <YAxis stroke="#333" fontSize={10} font-family="monospace" tickFormatter={(v) => `$${v}M`} />
            <Tooltip 
              contentStyle={{backgroundColor: '#000', border: '1px solid #FABF2C', borderRadius: '0px'}}
              itemStyle={{color: '#FABF2C', fontSize: '10px'}}
            />
            <Area type="monotone" dataKey="net" stroke="#FABF2C" fillOpacity={1} fill="url(#colorNet)" strokeWidth={3} />
          </AreaChart>
        </ResponsiveContainer>
      </div>

      <div className="mt-6 pt-6 border-t border-white/5 grid grid-cols-2 gap-4">
        <div>
          <p className="text-[10px] text-gray-500 uppercase font-bold">Large Inflow (24h)</p>
          <p className="text-xl font-black text-white">$1.24B</p>
        </div>
        <div className="text-right">
          <p className="text-[10px] text-gray-500 uppercase font-bold">Whale Sentiment</p>
          <p className="text-xl font-black text-green-500 uppercase italic">Bullish</p>
        </div>
      </div>
    </div>
  );
}

=== src/app/de-fi-analytics/components/ProtocolRankings.tsx ===
'use client';

import React from 'react';
import Icon from '@/components/ui/AppIcon';

interface Protocol {
  name: string;
  chain: string;
  category: string;
  tvl: number;
  change_1d: number;
  change_7d: number;
}

interface ProtocolRankingsProps {
  protocols: Protocol[];
}

const ProtocolRankings = ({ protocols }: ProtocolRankingsProps) => {
  return (
    <div className="bg-card border border-border overflow-hidden">
      <div className="p-6 border-b border-border flex justify-between items-center">
        <h2 className="text-xl font-bold font-heading">Top Protocols by TVL</h2>
        <span className="text-xs font-caption text-muted-foreground italic">Powered by DefiLlama</span>
      </div>
      
      <div className="overflow-x-auto">
        <table className="w-full text-left">
          <thead className="bg-secondary/50 text-xs font-caption uppercase tracking-wider">
            <tr>
              <th className="px-6 py-4">Rank</th>
              <th className="px-6 py-4">Protocol</th>
              <th className="px-6 py-4">Category</th>
              <th className="px-6 py-4 text-right">TVL (USD)</th>
              <th className="px-6 py-4 text-right">24h</th>
            </tr>
          </thead>
          <tbody className="divide-y divide-border">
            {protocols.map((p, index) => (
              <tr key={p.name} className="hover:bg-muted/30 transition-smooth">
                <td className="px-6 py-4 font-data text-sm text-muted-foreground">#{index + 1}</td>
                <td className="px-6 py-4">
                  <div className="font-bold font-heading text-foreground">{p.name}</div>
                  <div className="text-[10px] font-caption text-primary uppercase">{p.chain}</div>
                </td>
                <td className="px-6 py-4">
                  <span className="px-2 py-1 bg-secondary text-[10px] font-bold font-caption">
                    {p.category}
                  </span>
                </td>
                <td className="px-6 py-4 text-right font-data font-bold">
                  ${(p.tvl / 1e9).toFixed(2)}B
                </td>
                <td className={`px-6 py-4 text-right font-data text-sm ${p.change_1d >= 0 ? 'text-success' : 'text-error'}`}>
                  {p.change_1d?.toFixed(2)}%
                </td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>
    </div>
  );
};

export default ProtocolRankings;

=== src/app/de-fi-analytics/components/DeFiInteractive.tsx ===
'use client';
import React from 'react';
import ProtocolRankings from './ProtocolRankings';
import OnChainMetrics from './OnChainMetrics';
import AlphaGate from '@/components/auth/AlphaGate';
import WhaleWatch from './WhaleWatch';
import { AreaChart, Area, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, BarChart, Bar } from 'recharts';

const DeFiInteractive = ({ initialProtocols, dexVolume, stableMcap }: any) => {
  return (
    <div className="space-y-12">
      
      {/* 1. PUBLIC INTEL (Protocol Table) */}
      <div className="grid grid-cols-1 lg:grid-cols-12 gap-8">
        <div className="lg:col-span-8">
           <ProtocolRankings protocols={initialProtocols} />
        </div>
        <div className="lg:col-span-4">
           <OnChainMetrics />
        </div>
      </div>

      {/* 2. ALPHA INTEL (Charts locked in the Gate) */}
      <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <AlphaGate>
          <div className="bg-[#0a0a0a] border border-gray-900 p-8 shadow-2xl h-full">
            <h3 className="text-white font-black text-xs uppercase mb-8 border-l-2 border-primary pl-4 tracking-widest">Daily DEX Volume (7DMA)</h3>
            <div className="h-[300px]">
              <ResponsiveContainer width="100%" height="100%">
                <AreaChart data={dexVolume}>
                  <CartesianGrid strokeDasharray="3 3" stroke="#222" vertical={false} />
                  <XAxis dataKey="date" stroke="#444" fontSize={10} />
                  <YAxis stroke="#444" fontSize={10} tickFormatter={(v) => `$${(v/1e9).toFixed(1)}B`} />
                  <Tooltip contentStyle={{backgroundColor:'#000', border:'1px solid #333'}} />
                  <Area type="monotone" dataKey="volume" stroke="#FABF2C" fill="#FABF2C" fillOpacity={0.1} strokeWidth={2} />
                </AreaChart>
              </ResponsiveContainer>
            </div>
          </div>
        </AlphaGate>

        <AlphaGate>
          <div className="bg-[#0a0a0a] border border-gray-900 p-8 shadow-2xl h-full">
            <h3 className="text-white font-black text-xs uppercase mb-8 border-l-2 border-primary pl-4 tracking-widest">Total Stablecoin Supply</h3>
            <div className="h-[300px]">
              <ResponsiveContainer width="100%" height="100%">
                <BarChart data={stableMcap}>
                  <CartesianGrid strokeDasharray="3 3" stroke="#222" vertical={false} />
                  <XAxis dataKey="date" stroke="#444" fontSize={10} />
                  <YAxis stroke="#444" fontSize={10} tickFormatter={(v) => `$${(v/1e9).toFixed(0)}B`} />
                  <Bar dataKey="mcap" fill="#627EEA" radius={[2, 2, 0, 0]} />
                </BarChart>
              </ResponsiveContainer>
            </div>
          </div>
        </AlphaGate>
      </div>

      {/* 3. EXCLUSIVE ALPHA TOOLS */}
      <div className="grid grid-cols-1 lg:grid-cols-12 gap-8">
        <div className="lg:col-span-7">
          <AlphaGate>
            <WhaleWatch />
          </AlphaGate>
        </div>
        <div className="lg:col-span-5 bg-card border border-border p-8 flex items-center justify-center text-center">
            <div>
              <p className="text-primary font-black text-xs tracking-widest mb-2 uppercase">Member Status</p>
              <p className="text-white font-mono text-sm uppercase">Active Intelligence Stream Verified</p>
            </div>
        </div>
      </div>
    </div>
  );
};
export default DeFiInteractive;

=== src/app/de-fi-analytics/components/TheBlockDashboard.tsx ===
'use client';
import React from 'react';
import { AreaChart, Area, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, BarChart, Bar } from 'recharts';

export default function TheBlockDashboard({ dexVolume, stableMcap, protocols }: any) {
  return (
    <div className="space-y-12">
      <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <div className="bg-[#0a0a0a] border border-gray-900 p-8 shadow-2xl">
          <h3 className="text-white font-black text-xs uppercase mb-8 border-l-2 border-primary pl-4 tracking-widest">Daily DEX Volume (7DMA)</h3>
          <div className="h-[300px]">
            <ResponsiveContainer width="100%" height="100%">
              <AreaChart data={dexVolume}>
                <CartesianGrid strokeDasharray="3 3" stroke="#222" vertical={false} />
                <XAxis dataKey="date" stroke="#444" fontSize={10} />
                <YAxis stroke="#444" fontSize={10} tickFormatter={(v) => `$${(v/1e9).toFixed(1)}B`} />
                <Tooltip contentStyle={{backgroundColor:'#000', border:'1px solid #333'}} />
                <Area type="monotone" dataKey="volume" stroke="#FABF2C" fill="#FABF2C" fillOpacity={0.1} strokeWidth={2} />
              </AreaChart>
            </ResponsiveContainer>
          </div>
        </div>
        <div className="bg-[#0a0a0a] border border-gray-900 p-8 shadow-2xl">
          <h3 className="text-white font-black text-xs uppercase mb-8 border-l-2 border-primary pl-4 tracking-widest">Total Stablecoin Supply</h3>
          <div className="h-[300px]">
            <ResponsiveContainer width="100%" height="100%">
              <BarChart data={stableMcap}>
                <CartesianGrid strokeDasharray="3 3" stroke="#222" vertical={false} />
                <XAxis dataKey="date" stroke="#444" fontSize={10} />
                <YAxis stroke="#444" fontSize={10} tickFormatter={(v) => `$${(v/1e9).toFixed(0)}B`} />
                <Bar dataKey="mcap" fill="#627EEA" radius={[2, 2, 0, 0]} />
              </BarChart>
            </ResponsiveContainer>
          </div>
        </div>
      </div>
      <div className="bg-[#0a0a0a] border border-gray-900 overflow-hidden shadow-2xl">
        <table className="w-full text-left">
          <thead className="bg-black text-[10px] text-gray-500 font-black uppercase">
            <tr><th className="p-6">Protocol</th><th className="p-6 text-right">TVL</th><th className="p-6 text-right">1D Change</th></tr>
          </thead>
          <tbody className="divide-y divide-gray-900">
            {protocols.map((p: any) => (
              <tr key={p.name} className="hover:bg-white/5 transition-colors">
                <td className="p-6 font-bold text-white text-sm">{p.name} <span className="text-[10px] text-gray-600 ml-2 uppercase font-mono">{p.chain}</span></td>
                <td className="p-6 text-right font-mono text-white text-sm">${(p.tvl/1e9).toFixed(2)}B</td>
                <td className={`p-6 text-right font-mono text-xs ${p.change_1d >= 0 ? 'text-green-500' : 'text-red-500'}`}>{p.change_1d?.toFixed(2)}%</td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>
    </div>
  );
}

=== src/app/de-fi-analytics/components/TVLChart.tsx ===
'use client';
import React from 'react';
import { AreaChart, Area, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer } from 'recharts';

interface TVLChartProps {
  data: any[];
}

const TVLChart = ({ data }: TVLChartProps) => {
  return (
    <div className="bg-card border border-border p-6">
      <div className="flex justify-between items-center mb-6">
        <h2 className="text-2xl font-bold font-heading text-white">Total Value Locked (TVL)</h2>
        <span className="text-xs font-caption text-success">+8.2% (30d)</span>
      </div>
      <div className="w-full h-[400px]">
        <ResponsiveContainer width="100%" height="100%">
          <AreaChart data={data}>
            <defs>
              <linearGradient id="colorTvl" x1="0" y1="0" x2="0" y2="1">
                <stop offset="5%" stopColor="#FABF2C" stopOpacity={0.3}/>
                <stop offset="95%" stopColor="#FABF2C" stopOpacity={0}/>
              </linearGradient>
            </defs>
            <CartesianGrid strokeDasharray="3 3" stroke="#222" vertical={false} />
            <XAxis dataKey="date" stroke="#444" fontSize={12} />
            <YAxis stroke="#444" fontSize={12} tickFormatter={(val) => `$${(val/1e9).toFixed(0)}B`} />
            <Tooltip contentStyle={{backgroundColor: '#000', border: '1px solid #333'}} />
            <Area type="monotone" dataKey="tvl" stroke="#FABF2C" fillOpacity={1} fill="url(#colorTvl)" strokeWidth={3} />
          </AreaChart>
        </ResponsiveContainer>
      </div>
    </div>
  );
};
export default TVLChart;

=== src/app/de-fi-analytics/error.tsx ===
// src/app/de-fi-analytics/error.tsx
'use client';

export default function DeFiError({
  error,
  reset,
}: {
  error: Error;
  reset: () => void;
}) {
  return (
    <div className="flex items-center justify-center min-h-[50vh]">
      <div className="text-center">
        <div className="text-red-500 font-mono text-xs tracking-[0.3em] mb-4 uppercase">
          DEFI DATA FEED INTERRUPTED
        </div>
        <button
          onClick={reset}
          className="bg-primary text-black font-black text-xs px-6 py-3 uppercase tracking-widest hover:bg-white transition-colors"
        >
          RETRY CONNECTION
        </button>
      </div>
    </div>
  );
}

=== src/app/de-fi-analytics/page.tsx ===
// src/app/de-fi-analytics/page.tsx
import React from 'react';
import { DataSidebar } from '@/app/data/_components/DataSidebar';
import DeFiInteractive from './components/DeFiInteractive';
import {
  getDeFiProtocols,
  getDexVolume,
  getStablecoinData,
} from '@/lib/api';

export const metadata = {
  title: 'DeFi Intelligence',
  description: 'Institutional-grade DeFi analytics — TVL, DEX Volume, Stablecoins',
};

export default async function DeFiAnalyticsPage() {
  const [protocols, dexVolume, stableMcap] = await Promise.all([
    getDeFiProtocols(),
    getDexVolume(),
    getStablecoinData(),
  ]);

  return (
    <div className="flex max-w-[2000px] mx-auto border-l border-r border-[#1a1a1a]">
      <DataSidebar />

      <main className="flex-1 min-w-0 bg-[#050505] p-6 md:p-8">
        <div className="mb-10">
          <h1 className="text-4xl font-black font-heading uppercase tracking-tighter mb-2">
            DeFi <span className="text-primary">Terminal</span>
          </h1>
          <p className="text-[#444] font-mono text-[10px] uppercase tracking-[0.3em]">
            Institutional Grade Intelligence Hub • DefiLlama Feed
          </p>
          <div className="h-px w-20 bg-primary/40 mt-3" />
        </div>

        <DeFiInteractive
          initialProtocols={protocols}
          dexVolume={dexVolume}
          stableMcap={stableMcap}
        />
      </main>
    </div>
  );
}

=== src/app/not-found.tsx ===
'use client';

import React from 'react';
import { useRouter } from 'next/navigation';
import Icon from '@/components/ui/AppIcon';

export default function NotFound() {
    const router = useRouter();

    const handleGoHome = () => {
        router?.push('/homepage');
    };

    const handleGoBack = () => {
        if (typeof window !== 'undefined') {
            window.history?.back();
        }
    };

    return (
        <div className="min-h-screen flex flex-col items-center justify-center bg-background p-4">
            <div className="text-center max-w-md">
                <div className="flex justify-center mb-6">
                    <div className="relative">
                        <h1 className="text-9xl font-bold text-primary opacity-20">404</h1>
                    </div>
                </div>

                <h2 className="text-2xl font-medium text-foreground mb-2">Page Not Found</h2>
                <p className="text-muted-foreground mb-8">
                    The page you're looking for doesn't exist. Let's get you back!
                </p>

                <div className="flex flex-col sm:flex-row gap-4 justify-center">
                    <button
                        onClick={handleGoBack}
                        className="inline-flex items-center justify-center gap-2 bg-primary text-primary-foreground px-6 py-3 rounded-lg font-medium hover:bg-primary/90 transition-colors duration-200"
                    >
                        <Icon name="ArrowLeftIcon" size={16} />
                        Go Back
                    </button>

                    <button
                        onClick={handleGoHome}
                        className="inline-flex items-center justify-center gap-2 border border-border bg-background text-foreground px-6 py-3 rounded-lg font-medium hover:bg-accent hover:text-accent-foreground transition-colors duration-200"
                    >
                        <Icon name="HomeIcon" size={16} />
                        Back to Home
                    </button>
                </div>
            </div>
        </div>
    );
}

=== src/app/api/prices/route.ts ===
import { NextResponse } from 'next/server';
import { getLivePrices } from '@/lib/api';
import { FALLBACK_MARKET_DATA } from '@/lib/fallback-data';

export async function GET() {
  try {
    const prices = await getLivePrices();
    return NextResponse.json(prices || FALLBACK_MARKET_DATA);
  } catch (error) {
    return NextResponse.json(FALLBACK_MARKET_DATA);
  }
}

=== src/app/news/[id]/page.tsx ===
import React from 'react';
import { notFound } from 'next/navigation';
import type { Metadata } from 'next';
import { getArticleById, getRelatedArticles, calculateReadingTime } from '@/lib/api';
import { ReadingProgress } from './_components/ReadingProgress';
import { StickyShareBar } from './_components/StickyShareBar';
import { ArticleSidebar } from './_components/ArticleSidebar';
import Image from 'next/image';
import Link from 'next/link';
import type { NewsArticle } from '@/lib/types';

export async function generateMetadata({ params }: any): Promise<Metadata> {
  const { id } = await params;
  const article = await getArticleById(id);
  if (!article) return { title: 'Article Not Found' };
  return {
    title: article.title,
    description: article.body.slice(0, 160),
    openGraph: {
      title: article.title,
      description: article.body.slice(0, 160),
      images: article.image ? [{ url: article.image }] : [],
      type: 'article',
      publishedTime: new Date(article.published_on * 1000).toISOString(),
    },
  };
}

export default async function NewsArticlePage({ params }: any) {
  const { id } = await params;
  const [article, related] = await Promise.all([
    getArticleById(id), 
    getRelatedArticles(id, 4)
  ]);
  
  if (!article) notFound();

  const readingTime = calculateReadingTime(article.body);
  const publishDate = new Date(article.published_on * 1000).toLocaleDateString('en-US', { 
    month: 'short', day: 'numeric', year: 'numeric' 
  });

  return (
    <>
      <ReadingProgress />
      <main className="container mx-auto px-4 lg:px-8 py-8 lg:py-12">
        <div className="flex gap-6 lg:gap-10">
          <StickyShareBar title={article.title} articleId={id} />
          <article className="flex-1 min-w-0 max-w-[780px]">
            {article.categories && article.categories[0] && (
              <span className="inline-block bg-primary text-primary-foreground px-3 py-1 text-xs font-bold uppercase tracking-widest mb-5">
                {article.categories[0]}
              </span>
            )}
            <h1 className="text-3xl md:text-4xl lg:text-5xl font-black leading-[1.15] mb-6 text-foreground font-heading">
              {article.title}
            </h1>
            <div className="flex items-center gap-4 text-sm text-muted-foreground mb-8 pb-6 border-b border-border">
              <div className="w-10 h-10 rounded-full bg-card border border-border flex items-center justify-center text-xs font-bold text-primary">CB</div>
              <div>
                <div className="font-semibold text-foreground">CryptoBrain Editorial</div>
                <div className="flex items-center gap-2 text-xs text-muted-foreground font-caption">
                  <time dateTime={new Date(article.published_on * 1000).toISOString()}>{publishDate}</time>
                  <span>·</span>
                  <span>{readingTime} min read</span>
                </div>
              </div>
            </div>
            {article.image && (
              <figure className="mb-10">
                <div className="relative w-full aspect-video overflow-hidden bg-card">
                  <Image src={article.image} alt={article.title} fill sizes="(max-width: 768px) 100vw, 780px"
                         className="object-cover" priority />
                </div>
                <figcaption className="text-xs text-muted-foreground mt-2 font-caption">Source: {article.source}</figcaption>
              </figure>
            )}
            <div className="article-body prose prose-invert prose-lg max-w-none">
              {article.body.split('\n').filter(Boolean).map((para: string, idx: number) => (
                <p key={idx} className="mb-6 text-[17px] leading-[1.85] text-foreground/90 font-body">{para}</p>
              ))}
            </div>
            {article.tags && article.tags.length > 0 && (
              <div className="flex flex-wrap gap-2 mt-10 pt-6 border-t border-border">
                {article.tags.map((tag: string) => (
                  <span key={tag} className="px-3 py-1.5 text-xs bg-card border border-border text-muted-foreground hover:border-primary hover:text-primary transition-colors cursor-pointer font-caption">#{tag}</span>
                ))}
              </div>
            )}
            <div className="mt-10 p-6 bg-card border border-border">
              <div className="flex items-start gap-4">
                <div className="w-16 h-16 rounded-full bg-secondary border-2 border-primary flex items-center justify-center text-lg font-bold text-primary shrink-0">CB</div>
                <div>
                  <h4 className="font-bold text-foreground mb-1 font-heading text-lg">CryptoBrain Editorial</h4>
                  <p className="text-sm text-muted-foreground font-body leading-relaxed">
                    Our editorial team combines on‑chain analytics with institutional market intelligence.
                  </p>
                </div>
              </div>
            </div>
            {related.length > 0 && (
              <section className="mt-14">
                <h3 className="text-xl font-black mb-6 flex items-center gap-3 font-heading">
                  <span className="w-8 h-0.5 bg-primary" /> Related Stories
                </h3>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                  {related.map((rel: NewsArticle) => (
                    <Link key={rel.id} href={`/news/${rel.id}`} className="group block bg-card border border-border hover:border-primary/50 transition-colors overflow-hidden">
                      {rel.image && (
                        <div className="relative aspect-video">
                          <Image src={rel.image} alt={rel.title} fill sizes="(max-width: 768px) 100vw, 380px"
                                 className="object-cover group-hover:scale-105 transition-transform duration-500" />
                        </div>
                      )}
                      <div className="p-4">
                        <h4 className="font-bold text-sm text-foreground group-hover:text-primary transition-colors line-clamp-2 font-heading">
                          {rel.title}
                        </h4>
                        <span className="text-xs text-muted-foreground mt-2 block font-caption">{rel.source}</span>
                      </div>
                    </Link>
                  ))}
                </div>
              </section>
            )}
          </article>
          <ArticleSidebar />
        </div>
      </main>
    </>
  );
}

=== src/app/news/[id]/_components/ArticleSidebar.tsx ===
import { getRealNews } from '@/lib/api';
import Link from 'next/link';

export async function ArticleSidebar() {
  const trending = await getRealNews();
  return (
    <aside className="hidden xl:block w-[320px] shrink-0 space-y-8">
      <div className="bg-card border border-border p-6">
        <h4 className="font-bold text-xs uppercase tracking-wider text-primary mb-2">Daily Alpha</h4>
        <p className="text-sm text-muted-foreground mb-4">Get institutional‑grade crypto intelligence.</p>
        <form className="space-y-3">
          <input type="email" placeholder="your@email.com"
                 className="w-full px-4 py-2.5 bg-background border border-border text-foreground text-sm placeholder:text-muted-foreground focus:border-primary focus:outline-none" />
          <button className="w-full px-4 py-2.5 bg-primary text-primary-foreground text-sm font-bold uppercase tracking-wider hover:opacity-90">
            Subscribe
          </button>
        </form>
      </div>
      <div className="bg-card border border-border p-6">
        <h4 className="font-bold text-xs uppercase tracking-wider text-muted-foreground mb-4">Trending Now</h4>
        <ul className="space-y-4">
          {trending.slice(0, 5).map((article: any, idx: number) => (
            <li key={article.id}>
              <Link href={`/news/${article.id}`} className="flex gap-3 group">
                <span className="text-2xl font-black text-border group-hover:text-primary transition-colors font-data leading-none mt-0.5">
                  {String(idx + 1).padStart(2, '0')}
                </span>
                <span className="text-sm font-semibold text-foreground group-hover:text-primary line-clamp-2">
                  {article.title}
                </span>
              </Link>
            </li>
          ))}
        </ul>
      </div>
    </aside>
  );
}

=== src/app/news/[id]/_components/ReadingProgress.tsx ===
'use client';
import { useState, useEffect } from 'react';

export function ReadingProgress() {
  const [progress, setProgress] = useState(0);
  useEffect(() => {
    const onScroll = () => {
      const top = window.scrollY;
      const height = document.documentElement.scrollHeight - window.innerHeight;
      setProgress(height > 0 ? Math.min((top / height) * 100, 100) : 0);
    };
    window.addEventListener('scroll', onScroll, { passive: true });
    return () => window.removeEventListener('scroll', onScroll);
  }, []);
  return (
    <div className="fixed top-16 left-0 z-[1001] h-1 bg-transparent w-full">
      <div className="h-full bg-primary transition-[width] duration-100 ease-out" style={{ width: `${progress}%` }} />
    </div>
  );
}

=== src/app/news/[id]/_components/StickyShareBar.tsx ===
'use client';
import { useState, useEffect } from 'react';

export function StickyShareBar({ title, articleId }: { title: string; articleId: string }) {
  const [copied, setCopied] = useState(false);
  const [scrollPct, setScrollPct] = useState(0);
  const url = typeof window !== 'undefined' ? window.location.href : `https://cryptobrainnews.com/news/${articleId}`;

  useEffect(() => {
    const onScroll = () => {
      const top = window.scrollY;
      const height = document.documentElement.scrollHeight - window.innerHeight;
      setScrollPct(height > 0 ? Math.min((top / height) * 100, 100) : 0);
    };
    window.addEventListener('scroll', onScroll, { passive: true });
    return () => window.removeEventListener('scroll', onScroll);
  }, []);

  return (
    <aside className="hidden lg:flex flex-col items-center gap-3 w-10 shrink-0 sticky top-28 self-start">
      <div className="w-0.5 h-20 bg-border rounded-full overflow-hidden mb-2">
        <div className="w-full bg-primary transition-all duration-100" style={{ height: `${scrollPct}%` }} />
      </div>
      {[
        { icon: '𝕏', href: `https://x.com/intent/tweet?text=${encodeURIComponent(title)}&url=${encodeURIComponent(url)}` },
        { icon: 'in', href: `https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(url)}` },
        { icon: '📨', href: `https://t.me/share/url?url=${encodeURIComponent(url)}&text=${encodeURIComponent(title)}` },
      ].map(({ icon, href }) => (
        <a key={href} href={href} target="_blank" rel="noopener noreferrer"
           className="p-2.5 rounded bg-card border border-border text-muted-foreground hover:bg-primary hover:text-primary-foreground transition-all">
          <span className="text-xs font-bold">{icon}</span>
        </a>
      ))}
      <button onClick={async () => { await navigator.clipboard.writeText(url); setCopied(true); setTimeout(() => setCopied(false), 2000); }}
              className="p-2.5 rounded bg-card border border-border text-muted-foreground hover:bg-primary hover:text-primary-foreground">
        <span className="text-xs font-bold">{copied ? '✓' : '🔗'}</span>
      </button>
    </aside>
  );
}

=== src/app/learning/page.tsx ===
import React from 'react';
import Header from '@/components/common/Header';
import PriceTicker from '@/components/common/PriceTicker';
import AppImage from '@/components/ui/AppImage';
import Icon from '@/components/ui/AppIcon';

export default function LearningHub() {
  const courses = [
    {
      title: "Bitcoin Fundamentals",
      level: "Beginner",
      duration: "2h • 5 Mods",
      image: "https://images.unsplash.com/photo-1518546305927-5a555bb7020d?auto=format&fit=crop&q=80&w=500",
      color: "bg-orange-500"
    },
    {
      title: "DeFi Yield Strategies",
      level: "Intermediate",
      duration: "4h • 8 Mods",
      image: "https://images.unsplash.com/photo-1639762681485-074b7f938ba0?auto=format&fit=crop&q=80&w=500",
      color: "bg-blue-500"
    },
    {
      title: "On-Chain Analysis",
      level: "Advanced",
      duration: "6h • 12 Mods",
      image: "https://images.unsplash.com/photo-1642104704074-907c0698cbd9?auto=format&fit=crop&q=80&w=500",
      color: "bg-purple-500"
    }
  ];

  return (
    <div className="min-h-screen bg-black text-white">
      <Header />
      <PriceTicker />
      
      <main className="container mx-auto px-4 py-12">
        <div className="text-center mb-16">
          <h1 className="text-6xl font-bold font-serif mb-4">LEARNING <span className="text-primary">HUB.</span></h1>
          <p className="text-gray-400 text-xl font-mono">MASTER THE ON-CHAIN ECONOMY</p>
        </div>

        <div className="mb-8">
          <h2 className="text-2xl font-bold font-serif mb-6 border-b border-gray-800 pb-4">START HERE: FOUNDATIONS</h2>
          <div className="grid grid-cols-1 md:grid-cols-3 gap-8">
            {courses.map((course, i) => (
              <div key={i} className="group cursor-pointer">
                <div className="relative h-64 mb-4 overflow-hidden border border-gray-800 group-hover:border-primary transition-colors">
                  <div className={`absolute top-4 left-4 ${course.color} text-black text-xs font-bold px-2 py-1 uppercase`}>
                    {course.level}
                  </div>
                  <AppImage src={course.image} alt={course.title} fill className="object-cover transition-transform duration-700 group-hover:scale-110 opacity-80 group-hover:opacity-100" />
                </div>
                <div className="flex justify-between items-start">
                  <div>
                    <h3 className="text-2xl font-bold font-serif mb-2 group-hover:text-primary transition-colors">{course.title}</h3>
                    <p className="text-gray-500 text-sm font-mono">{course.duration}</p>
                  </div>
                  <Icon name="ArrowRightIcon" className="text-gray-600 group-hover:text-primary" />
                </div>
              </div>
            ))}
          </div>
        </div>

        <div className="bg-primary text-black p-12 text-center mt-20">
          <h2 className="text-4xl font-bold font-serif mb-4">UNLOCK PREMIUM DEEP DIVES</h2>
          <p className="text-lg font-mono mb-8 max-w-2xl mx-auto">Join the alpha community to get exclusive access to wallet security guides and tax strategies.</p>
          <button className="bg-black text-white px-8 py-4 font-bold uppercase hover:bg-white hover:text-black transition-colors">
            Upgrade to Alpha
          </button>
        </div>
      </main>
    </div>
  );
}

=== src/app/page.tsx ===
// src/app/page.tsx
// ─── Root route redirects to homepage ─────────────────────────────────────
import { redirect } from 'next/navigation';

export default function RootPage() {
  redirect('/homepage');
}

=== src/app/go-alpha/page.tsx ===
import React from 'react';
import Header from '@/components/common/Header';
import Icon from '@/components/ui/AppIcon';

export default function GoAlpha() {
  return (
    <div className="min-h-screen bg-black text-white">
      <Header />
      
      <main className="container mx-auto px-4 py-20">
        <div className="grid grid-cols-1 lg:grid-cols-2 gap-16 items-center mb-24">
          <div>
            <div className="inline-block bg-primary text-black font-bold px-3 py-1 text-sm mb-6">THE DEFIANT ALPHA</div>
            <h1 className="text-6xl font-bold font-serif mb-6 leading-tight">
              Join <span className="text-primary underline decoration-4 underline-offset-8">Alpha.</span><br/>
              Learn Together.<br/>
              Earn Together.
            </h1>
            <p className="text-xl text-gray-400 mb-8 leading-relaxed">
              The premium subscription designed for crypto natives who want to up their game. Get institutional-grade reports, private discord access, and yield farming strategies.
            </p>
            <button className="bg-primary text-black text-lg font-bold px-8 py-4 rounded-none hover:bg-white transition-colors">
              Try Free for 21 Days
            </button>
          </div>
          <div className="bg-gray-900 border border-gray-800 p-8 h-96 flex items-center justify-center">
             <div className="text-center">
               <Icon name="LockClosedIcon" className="mx-auto text-primary mb-4" size={64} />
               <p className="text-gray-500 font-mono">PREMIUM CONTENT LOCKED</p>
             </div>
          </div>
        </div>

        {/* Pricing Cards */}
        <div className="max-w-5xl mx-auto mb-24">
          <h2 className="text-center text-3xl font-bold font-serif mb-12">Choose Your Edge</h2>
          <div className="grid grid-cols-1 md:grid-cols-3 gap-8">
            {/* Monthly */}
            <div className="border border-gray-800 p-8 hover:border-gray-600 transition-colors">
              <h3 className="text-primary font-bold mb-2">Alpha Monthly</h3>
              <div className="text-4xl font-bold mb-6">$15 <span className="text-sm text-gray-500 font-normal">/mo</span></div>
              <ul className="space-y-4 mb-8 text-sm text-gray-300">
                <li className="flex gap-2"><Icon name="CheckIcon" className="text-primary" size={16}/> Daily Alpha Newsletter</li>
                <li className="flex gap-2"><Icon name="CheckIcon" className="text-primary" size={16}/> 200+ Premium Tutorials</li>
                <li className="flex gap-2"><Icon name="CheckIcon" className="text-primary" size={16}/> Private Telegram Group</li>
              </ul>
              <button className="w-full border border-white py-3 font-bold hover:bg-white hover:text-black transition-colors">CHOOSE PLAN</button>
            </div>

            {/* Yearly (Highlighted) */}
            <div className="border-2 border-primary bg-gray-900 p-8 transform scale-105 relative">
              <div className="absolute top-0 right-0 bg-primary text-black text-xs font-bold px-2 py-1">BEST VALUE</div>
              <h3 className="text-primary font-bold mb-2">Alpha Yearly</h3>
              <div className="text-4xl font-bold mb-6">$144 <span className="text-sm text-gray-500 font-normal">/yr</span></div>
              <ul className="space-y-4 mb-8 text-sm text-gray-300">
                <li className="flex gap-2"><Icon name="CheckIcon" className="text-primary" size={16}/> All Monthly Features</li>
                <li className="flex gap-2"><Icon name="CheckIcon" className="text-primary" size={16}/> Exclusive Analyst Calls</li>
                <li className="flex gap-2"><Icon name="CheckIcon" className="text-primary" size={16}/> Early Access to Reports</li>
                <li className="flex gap-2"><Icon name="CheckIcon" className="text-primary" size={16}/> Save 20% vs Monthly</li>
              </ul>
              <button className="w-full bg-primary text-black py-3 font-bold hover:bg-white transition-colors">SELECTED</button>
            </div>

            {/* Crypto Payment */}
            <div className="border border-gray-800 p-8 hover:border-gray-600 transition-colors">
              <h3 className="text-primary font-bold mb-2">Pay with Crypto</h3>
              <div className="text-4xl font-bold mb-6">$108 <span className="text-sm text-gray-500 font-normal">/yr</span></div>
              <ul className="space-y-4 mb-8 text-sm text-gray-300">
                <li className="flex gap-2"><Icon name="CheckIcon" className="text-primary" size={16}/> Pay with USDC/ETH</li>
                <li className="flex gap-2"><Icon name="CheckIcon" className="text-primary" size={16}/> No Recurring Fees</li>
                <li className="flex gap-2"><Icon name="CheckIcon" className="text-primary" size={16}/> Save 40% vs Monthly</li>
              </ul>
              <button className="w-full border border-white py-3 font-bold hover:bg-white hover:text-black transition-colors">CONNECT WALLET</button>
            </div>
          </div>
        </div>
      </main>
    </div>
  );
}

=== src/app/price-indexes/loading.tsx ===
// src/app/price-indexes/loading.tsx
export default function PriceIndexesLoading() {
  return (
    <main className="min-h-screen bg-[#050505]">
      <div className="max-w-[1800px] mx-auto px-4 lg:px-6 py-6">
        {/* Header skeleton */}
        <div className="mb-6">
          <div className="h-8 w-96 bg-white/5 animate-pulse mb-2" />
          <div className="h-4 w-64 bg-white/5 animate-pulse" />
        </div>

        {/* Highlight cards skeleton */}
        <div className="grid grid-cols-3 gap-4 mb-6">
          {[1, 2, 3].map((i) => (
            <div key={i} className="h-40 bg-white/5 animate-pulse border border-white/5" />
          ))}
        </div>

        {/* Table skeleton */}
        <div className="border border-[#1a1a1a]">
          <div className="h-10 bg-[#0a0a0a] border-b border-[#1a1a1a]" />
          {Array.from({ length: 15 }).map((_, i) => (
            <div
              key={i}
              className="h-12 border-b border-[#0d0d0d] animate-pulse"
              style={{ opacity: 1 - i * 0.05 }}
            />
          ))}
        </div>
      </div>
    </main>
  );
}

=== src/app/price-indexes/components/TerminalTableRow.tsx ===
// src/app/price-indexes/components/TerminalTableRow.tsx
'use client';

import React from 'react';
import type { PriceTableRow } from '@/lib/types';
import MiniSparkline from './MiniSparkline';

interface Props {
  coin: PriceTableRow;
  isEven: boolean;
}

// Format price with appropriate decimals
function fmtPrice(price: number): string {
  if (price >= 1000) return price.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
  if (price >= 1) return price.toFixed(2);
  if (price >= 0.01) return price.toFixed(4);
  return price.toFixed(6);
}

// Format large numbers
function fmtCompact(val: number): string {
  if (val >= 1e12) return `$${(val / 1e12).toFixed(2)}T`;
  if (val >= 1e9) return `$${(val / 1e9).toFixed(2)}B`;
  if (val >= 1e6) return `$${(val / 1e6).toFixed(1)}M`;
  if (val >= 1e3) return `$${(val / 1e3).toFixed(0)}K`;
  return `$${val.toFixed(0)}`;
}

// Color class for percentage change
function changeColor(val: number): string {
  if (val > 0) return 'text-[#00d672]';
  if (val < 0) return 'text-[#ff4757]';
  return 'text-[#555]';
}

function fmtChange(val: number): string {
  const prefix = val > 0 ? '+' : '';
  return `${prefix}${val.toFixed(2)}%`;
}

export default function TerminalTableRow({ coin, isEven }: Props) {
  const bg = isEven ? 'bg-[#080808]' : 'bg-[#0b0b0b]';

  return (
    <tr
      className={`${bg} border-b border-[#111] hover:bg-[#0f0f0f] transition-colors duration-75 group`}
    >
      {/* Rank */}
      <td className="px-3 py-[10px] w-10">
        <span className="text-[11px] font-mono text-[#444] tabular-nums">
          {coin.rank}
        </span>
      </td>

      {/* Asset */}
      <td className="px-3 py-[10px]">
        <div className="flex items-center gap-2.5 min-w-[140px]">
          <img
            src={coin.image}
            alt=""
            className="w-5 h-5 rounded-full flex-shrink-0"
            loading="lazy"
            onError={(e) => {
              e.currentTarget.style.display = 'none';
            }}
          />
          <div className="flex items-center gap-2">
            <span className="text-[12px] font-bold text-white tracking-wide">
              {coin.symbol.toUpperCase()}
            </span>
            <span className="text-[10px] text-[#444] font-mono hidden xl:inline truncate max-w-[100px]">
              {coin.name}
            </span>
          </div>
        </div>
      </td>

      {/* Price */}
      <td className="px-3 py-[10px] text-right">
        <span className="text-[12px] font-mono font-bold text-white tabular-nums">
          ${fmtPrice(coin.price)}
        </span>
      </td>

      {/* 1H % */}
      <td className="px-3 py-[10px] text-right">
        <span className={`text-[11px] font-mono font-bold tabular-nums ${changeColor(coin.change1h)}`}>
          {fmtChange(coin.change1h)}
        </span>
      </td>

      {/* 24H % */}
      <td className="px-3 py-[10px] text-right">
        <span className={`text-[11px] font-mono font-bold tabular-nums ${changeColor(coin.change24h)}`}>
          {fmtChange(coin.change24h)}
        </span>
      </td>

      {/* 7D % */}
      <td className="px-3 py-[10px] text-right">
        <span className={`text-[11px] font-mono font-bold tabular-nums ${changeColor(coin.change7d)}`}>
          {fmtChange(coin.change7d)}
        </span>
      </td>

      {/* Market Cap */}
      <td className="px-3 py-[10px] text-right">
        <span className="text-[11px] font-mono text-[#888] tabular-nums">
          {fmtCompact(coin.marketCap)}
        </span>
      </td>

      {/* Volume */}
      <td className="px-3 py-[10px] text-right">
        <span className="text-[11px] font-mono text-[#666] tabular-nums">
          {fmtCompact(coin.volume24h)}
        </span>
      </td>

      {/* Sparkline */}
      <td className="px-3 py-[10px] w-[100px]">
        <MiniSparkline
          data={coin.sparkline}
          isPositive={coin.change7d >= 0}
        />
      </td>
    </tr>
  );
}

=== src/app/price-indexes/components/MiniSparkline.tsx ===
'use client';
import React, { useMemo } from 'react';

export default function MiniSparkline({ data, isPositive }: { data: number[], isPositive: boolean }) {
  const path = useMemo(() => {
    if (!data || data.length < 2) return '';
    const step = Math.max(1, Math.floor(data.length / 24));
    const sampled = data.filter((_, i) => i % step === 0);
    const min = Math.min(...sampled);
    const max = Math.max(...sampled);
    const range = max - min || 1;
    const width = 80;
    const height = 28;
    const points = sampled.map((val, i) => {
      const x = 2 + (i / (sampled.length - 1)) * 76;
      const y = 2 + (1 - (val - min) / range) * 24;
      return `${x.toFixed(1)},${y.toFixed(1)}`;
    });
    return `M${points.join(' L')}`;
  }, [data]);

  if (!path) return <div className="w-20 h-7" />;
  return (
    <svg viewBox="0 0 80 28" className="w-20 h-7 ml-auto" preserveAspectRatio="none">
      <path d={path} fill="none" stroke={isPositive ? '#00d672' : '#ff4757'} strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round" />
    </svg>
  );
}

=== src/app/price-indexes/components/PriceIndexesTerminal.tsx ===
// src/app/price-indexes/components/PriceIndexesTerminal.tsx
'use client';

import React, { useState, useMemo, useCallback } from 'react';
import type { PriceTableRow, NewsArticle } from '@/lib/types';
import TerminalTableRow from './TerminalTableRow';
import MiniSparkline from './MiniSparkline';
import TerminalHighlights from './TerminalHighlights';

interface Props {
  initialCoins: PriceTableRow[];
  initialNews: NewsArticle[];
}

type SortField = 'rank' | 'price' | 'change1h' | 'change24h' | 'change7d' | 'marketCap' | 'volume24h';
type SortDir = 'asc' | 'desc';

export default function PriceIndexesTerminal({ initialCoins, initialNews }: Props) {
  const [coins] = useState<PriceTableRow[]>(initialCoins);
  const [sortField, setSortField] = useState<SortField>('rank');
  const [sortDir, setSortDir] = useState<SortDir>('asc');
  const [searchQuery, setSearchQuery] = useState('');

  const handleSort = useCallback((field: SortField) => {
    if (sortField === field) {
      setSortDir((d) => (d === 'asc' ? 'desc' : 'asc'));
    } else {
      setSortField(field);
      setSortDir(field === 'rank' ? 'asc' : 'desc');
    }
  }, [sortField]);

  const filteredAndSorted = useMemo(() => {
    let result = [...coins];

    // Filter
    if (searchQuery.trim()) {
      const q = searchQuery.toLowerCase();
      result = result.filter(
        (c) =>
          c.name.toLowerCase().includes(q) ||
          c.symbol.toLowerCase().includes(q)
      );
    }

    // Sort
    result.sort((a, b) => {
      const aVal = a[sortField];
      const bVal = b[sortField];
      const multiplier = sortDir === 'asc' ? 1 : -1;
      return (Number(aVal) - Number(bVal)) * multiplier;
    });

    return result;
  }, [coins, sortField, sortDir, searchQuery]);

  const SortHeader = ({
    field,
    label,
    align = 'right',
  }: {
    field: SortField;
    label: string;
    align?: 'left' | 'right';
  }) => {
    const isActive = sortField === field;
    return (
      <th
        className={`px-3 py-2 cursor-pointer select-none group whitespace-nowrap ${
          align === 'right' ? 'text-right' : 'text-left'
        }`}
        onClick={() => handleSort(field)}
      >
        <span
          className={`text-[10px] font-black uppercase tracking-wider transition-colors ${
            isActive
              ? 'text-primary'
              : 'text-[#555] group-hover:text-[#888]'
          }`}
        >
          {label}
          {isActive && (
            <span className="ml-1">{sortDir === 'asc' ? '▲' : '▼'}</span>
          )}
        </span>
      </th>
    );
  };

  return (
    <div className="space-y-6">
      {/* Terminal Header */}
      <div className="flex items-end justify-between gap-4">
        <div>
          <div className="flex items-center gap-3 mb-1">
            <span className="w-2 h-2 bg-green-500 rounded-full animate-pulse" />
            <span className="text-[10px] font-mono text-green-500 uppercase tracking-[0.3em]">
              LIVE
            </span>
          </div>
          <h1 className="text-3xl font-black font-heading uppercase tracking-tight text-white">
            Price <span className="text-primary">Index</span>
          </h1>
          <p className="text-[10px] font-mono text-[#555] uppercase tracking-[0.2em] mt-1">
            TOP {coins.length} ASSETS BY MARKET CAP • USD
          </p>
        </div>

        {/* Search */}
        <div className="relative">
          <input
            type="text"
            value={searchQuery}
            onChange={(e) => setSearchQuery(e.target.value)}
            placeholder="SEARCH ASSET..."
            className="bg-[#0a0a0a] border border-[#1a1a1a] text-white font-mono text-[11px] 
                       px-4 py-2 w-64 outline-none focus:border-primary/50 placeholder:text-[#333]
                       uppercase tracking-wider"
          />
        </div>
      </div>

      {/* Highlight Cards */}
      <TerminalHighlights coins={coins} news={initialNews} />

      {/* ─── THE TABLE ─────────────────────────────────────────────── */}
      <div className="border border-[#1a1a1a] bg-[#080808] overflow-hidden">
        <div className="overflow-x-auto">
          <table className="w-full border-collapse">
            {/* STICKY HEADER */}
            <thead className="sticky top-0 z-10 bg-[#0a0a0a] border-b-2 border-[#1a1a1a]">
              <tr>
                <SortHeader field="rank" label="#" align="left" />
                <th className="px-3 py-2 text-left">
                  <span className="text-[10px] font-black text-[#555] uppercase tracking-wider">
                    Asset
                  </span>
                </th>
                <SortHeader field="price" label="Price" />
                <SortHeader field="change1h" label="1H %" />
                <SortHeader field="change24h" label="24H %" />
                <SortHeader field="change7d" label="7D %" />
                <SortHeader field="marketCap" label="Mkt Cap" />
                <SortHeader field="volume24h" label="Vol 24H" />
                <th className="px-3 py-2 text-right">
                  <span className="text-[10px] font-black text-[#555] uppercase tracking-wider">
                    7D Chart
                  </span>
                </th>
              </tr>
            </thead>

            <tbody>
              {filteredAndSorted.map((coin, index) => (
                <TerminalTableRow
                  key={coin.id}
                  coin={coin}
                  isEven={index % 2 === 0}
                />
              ))}
            </tbody>
          </table>
        </div>

        {filteredAndSorted.length === 0 && (
          <div className="py-20 text-center">
            <p className="text-[#333] font-mono text-xs uppercase tracking-widest">
              No assets match "{searchQuery}"
            </p>
          </div>
        )}
      </div>

      {/* Terminal footer */}
      <div className="flex justify-between items-center text-[9px] font-mono text-[#333] uppercase tracking-widest px-1">
        <span>DATA: COINGECKO API • REFRESH: 60S</span>
        <span>{filteredAndSorted.length} ASSETS</span>
      </div>
    </div>
  );
}

=== src/app/price-indexes/components/TerminalHighlights.tsx ===
// src/app/price-indexes/components/TerminalHighlights.tsx
'use client';

import React, { useMemo } from 'react';
import type { PriceTableRow, NewsArticle } from '@/lib/types';

interface Props {
  coins: PriceTableRow[];
  news: NewsArticle[];
}

function ChangeCell({ value }: { value: number }) {
  const color =
    value > 0 ? 'text-[#00d672]' : value < 0 ? 'text-[#ff4757]' : 'text-[#555]';
  const prefix = value > 0 ? '+' : '';
  return (
    <span className={`font-mono font-bold text-sm tabular-nums ${color}`}>
      {prefix}{value.toFixed(2)}%
    </span>
  );
}

export default function TerminalHighlights({ coins, news }: Props) {
  const { gainers, losers, totalMcap } = useMemo(() => {
    const sorted = [...coins].sort((a, b) => b.change24h - a.change24h);
    const totalMcap = coins.reduce((sum, c) => sum + c.marketCap, 0);
    return {
      gainers: sorted.slice(0, 4),
      losers: sorted.slice(-4).reverse(),
      totalMcap,
    };
  }, [coins]);

  return (
    <div className="grid grid-cols-1 lg:grid-cols-3 gap-4">
      {/* Gainers */}
      <div className="bg-[#080808] border border-[#1a1a1a] p-4">
        <div className="flex items-center justify-between mb-3 pb-2 border-b border-[#111]">
          <span className="text-[10px] font-black text-[#00d672] uppercase tracking-[0.2em]">
            ▲ TOP GAINERS
          </span>
          <span className="text-[9px] font-mono text-[#333]">24H</span>
        </div>
        <div className="space-y-2">
          {gainers.map((c) => (
            <div key={c.id} className="flex items-center justify-between">
              <div className="flex items-center gap-2">
                <img src={c.image} alt="" className="w-4 h-4 rounded-full" onError={e => e.currentTarget.style.display='none'} />
                <span className="text-[11px] font-bold text-white">{c.symbol.toUpperCase()}</span>
              </div>
              <ChangeCell value={c.change24h} />
            </div>
          ))}
        </div>
      </div>

      {/* Losers */}
      <div className="bg-[#080808] border border-[#1a1a1a] p-4">
        <div className="flex items-center justify-between mb-3 pb-2 border-b border-[#111]">
          <span className="text-[10px] font-black text-[#ff4757] uppercase tracking-[0.2em]">
            ▼ TOP LOSERS
          </span>
          <span className="text-[9px] font-mono text-[#333]">24H</span>
        </div>
        <div className="space-y-2">
          {losers.map((c) => (
            <div key={c.id} className="flex items-center justify-between">
              <div className="flex items-center gap-2">
                <img src={c.image} alt="" className="w-4 h-4 rounded-full" onError={e => e.currentTarget.style.display='none'} />
                <span className="text-[11px] font-bold text-white">{c.symbol.toUpperCase()}</span>
              </div>
              <ChangeCell value={c.change24h} />
            </div>
          ))}
        </div>
      </div>

      {/* Market Pulse */}
      <div className="bg-[#080808] border border-[#1a1a1a] p-4">
        <div className="flex items-center justify-between mb-3 pb-2 border-b border-[#111]">
          <span className="text-[10px] font-black text-primary uppercase tracking-[0.2em]">
            ◆ MARKET WIRE
          </span>
          <span className="text-[9px] font-mono text-[#333]">LIVE</span>
        </div>
        <div className="space-y-2.5">
          {news.slice(0, 4).map((n, i) => (
            <a
              key={n.id || i}
              href={n.url}
              target="_blank"
              rel="noopener noreferrer"
              className="block group"
            >
              <p className="text-[10px] font-bold text-[#888] group-hover:text-primary transition-colors line-clamp-1 leading-snug">
                {n.title}
              </p>
              <span className="text-[9px] font-mono text-[#333]">
                {n.source}
              </span>
            </a>
          ))}
        </div>
      </div>
    </div>
  );
}

=== src/app/price-indexes/error.tsx ===
// src/app/price-indexes/error.tsx
'use client';

export default function PriceIndexesError({
  error,
  reset,
}: {
  error: Error & { digest?: string };
  reset: () => void;
}) {
  return (
    <main className="min-h-screen bg-[#050505] flex items-center justify-center">
      <div className="text-center">
        <div className="text-red-500 font-mono text-xs tracking-[0.3em] mb-4 uppercase">
          TERMINAL ERROR
        </div>
        <p className="text-white/50 font-mono text-sm mb-6 max-w-md">
          Data feed interrupted. This may be due to API rate limiting.
        </p>
        <button
          onClick={reset}
          className="bg-primary text-black font-black text-xs px-6 py-3 uppercase tracking-widest hover:bg-white transition-colors"
        >
          RECONNECT
        </button>
      </div>
    </main>
  );
}

=== src/app/price-indexes/page.tsx ===
import React, { Suspense } from 'react';
import { getLivePrices, getRealNews } from '@/lib/api';
import type { PriceTableRow } from '@/lib/types';
import PriceIndexesTerminal from './components/PriceIndexesTerminal';

export const metadata = { title: 'Price Indexes | CBN Terminal' };

export default async function PriceIndexesPage() {
  const [rawCoins, news] = await Promise.all([
    getLivePrices(),
    getRealNews(),
  ]);

  const coins: PriceTableRow[] = rawCoins.map((coin, index) => ({
    id: coin.id,
    rank: coin.market_cap_rank ?? index + 1,
    name: coin.name,
    symbol: coin.symbol,
    image: coin.image,
    price: coin.current_price ?? 0,
    change1h: coin.price_change_percentage_1h_in_currency ?? 0,
    change24h: coin.price_change_percentage_24h ?? 0,
    change7d: coin.price_change_percentage_7d_in_currency ?? 0,
    marketCap: coin.market_cap ?? 0,
    volume24h: coin.total_volume ?? 0,
    sparkline: coin.sparkline_in_7d?.price ?? [],
  }));

  return (
    <main className="min-h-screen bg-[#050505] py-6 px-4 lg:px-6">
      <div className="max-w-[1800px] mx-auto">
        <Suspense fallback={<div className="text-primary font-mono text-xs animate-pulse">LOADING TERMINAL...</div>}>
          <PriceIndexesTerminal initialCoins={coins} initialNews={news} />
        </Suspense>
      </div>
    </main>
  );
}

=== src/components/layout/Footer.tsx ===
import React from 'react';
import Link from 'next/link';

export default function Footer() {
  return (
    <footer className="bg-black border-t border-[#1a1a1a] py-16 px-4 lg:px-8 mt-20">
      <div className="container mx-auto grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-12">
        <div className="space-y-6">
          <div className="flex items-center gap-2">
            <div className="w-8 h-8 bg-primary rounded flex items-center justify-center font-black text-black">C</div>
            <span className="text-xl font-black tracking-tighter text-white uppercase">CryptoBrain</span>
          </div>
          <p className="text-[#444] text-xs leading-relaxed font-medium max-w-xs">
            The definitive source for institutional-grade crypto intelligence, DeFi data, and on-chain education.
          </p>
          <div className="flex gap-4">
            {[
              { id: 'tw', label: 'X' },
              { id: 'tg', label: 'TG' },
              { id: 'dc', label: 'DC' },
              { id: 'li', label: 'IN' }
            ].map((social) => (
              <div key={social.id} className="w-8 h-8 border border-[#1a1a1a] flex items-center justify-center text-[10px] text-[#444] hover:border-primary hover:text-primary cursor-pointer transition-all">
                {social.label}
              </div>
            ))}
          </div>
        </div>

        <div>
          <h4 className="text-[10px] font-black text-primary uppercase tracking-[0.2em] mb-6">Network</h4>
          <ul className="space-y-4">
            {['News Hub', 'Data Terminal', 'Learning Hub', 'Go Alpha'].map((item) => (
              <li key={item}>
                <Link href="/homepage" className="text-[#666] text-xs hover:text-white transition-colors uppercase font-bold">{item}</Link>
              </li>
            ))}
          </ul>
        </div>

        <div>
          <h4 className="text-[10px] font-black text-primary uppercase tracking-[0.2em] mb-6">Policies</h4>
          <ul className="space-y-4">
            {['Privacy Policy', 'Terms of Service', 'Cookie Policy', 'Editorial Guidelines'].map((item) => (
              <li key={item}>
                <Link href="/homepage" className="text-[#666] text-xs hover:text-white transition-colors uppercase font-bold">{item}</Link>
              </li>
            ))}
          </ul>
        </div>

        <div>
          <h4 className="text-[10px] font-black text-primary uppercase tracking-[0.2em] mb-6">Daily Briefing</h4>
          <p className="text-[#444] text-xs mb-6 font-medium">Institutional alpha delivered to your inbox every morning.</p>
          <form className="flex">
            <input 
              type="email" 
              placeholder="Email address" 
              className="bg-[#0a0a0a] border border-[#1a1a1a] px-4 py-2 text-xs text-white focus:outline-none focus:border-primary flex-grow"
            />
            <button className="bg-primary text-black px-4 py-2 text-[10px] font-black uppercase tracking-widest hover:bg-white transition-all">Join</button>
          </form>
        </div>
      </div>
      
      <div className="container mx-auto mt-16 pt-8 border-t border-[#111] flex justify-between items-center">
        <p className="text-[9px] text-[#333] font-mono uppercase tracking-widest">
          © 2026 CryptoBrainNews. Market Data by DefiLlama.
        </p>
      </div>
    </footer>
  );
}

=== src/components/ui/AppImage.tsx ===
'use client';

import React, { useState } from 'react';
import Image from 'next/image';

interface AppImageProps {
    src: string;
    alt: string;
    width?: number;
    height?: number;
    className?: string;
    priority?: boolean;
    quality?: number;
    placeholder?: 'blur' | 'empty';
    blurDataURL?: string;
    fill?: boolean;
    sizes?: string;
    onClick?: () => void;
    fallbackSrc?: string;
    [key: string]: any;
}

function AppImage({
    src,
    alt,
    width,
    height,
    className = '',
    priority = false,
    quality = 75,
    placeholder = 'empty',
    blurDataURL,
    fill = false,
    sizes,
    onClick,
    fallbackSrc = '/assets/images/no_image.png', // Ensure this asset exists later
    ...props
}: AppImageProps) {
    const [imageSrc, setImageSrc] = useState(src);
    const [isLoading, setIsLoading] = useState(true);
    const [hasError, setHasError] = useState(false);

    const isExternal = imageSrc.startsWith('http://') || imageSrc.startsWith('https://');
    const isLocal = imageSrc.startsWith('/') || imageSrc.startsWith('./') || imageSrc.startsWith('data:');

    const handleError = () => {
        if (!hasError && imageSrc !== fallbackSrc) {
            // setImageSrc(fallbackSrc); // Commented out to prevent loop if fallback is missing
            setHasError(true);
        }
        setIsLoading(false);
    };

    const handleLoad = () => {
        setIsLoading(false);
        setHasError(false);
    };

    const commonClassName = `${className} ${isLoading ? 'bg-gray-200' : ''} ${onClick ? 'cursor-pointer hover:opacity-90 transition-opacity' : ''}`;

    if (isExternal && !isLocal) {
        const imgStyle: React.CSSProperties = {};
        if (width) imgStyle.width = width;
        if (height) imgStyle.height = height;

        if (fill) {
            return (
                <div className={`relative ${className}`} style={{ width: width || '100%', height: height || '100%' }}>
                    <img
                        src={imageSrc}
                        alt={alt}
                        className={`${commonClassName} absolute inset-0 w-full h-full object-cover`}
                        onError={handleError}
                        onLoad={handleLoad}
                        onClick={onClick}
                        style={imgStyle}
                        {...props}
                    />
                </div>
            );
        }

        return (
            <img
                src={imageSrc}
                alt={alt}
                className={commonClassName}
                onError={handleError}
                onLoad={handleLoad}
                onClick={onClick}
                style={imgStyle}
                {...props}
            />
        );
    }

    const imageProps = {
        src: imageSrc,
        alt,
        className: commonClassName,
        priority,
        quality,
        placeholder,
        blurDataURL,
        unoptimized: true,
        onError: handleError,
        onLoad: handleLoad,
        onClick,
        ...props,
    };

    if (fill) {
        return (
            <div className={`relative ${className}`}>
                <Image
                    {...imageProps}
                    fill
                    sizes={sizes || '100vw'}
                    style={{ objectFit: 'cover' }}
                />
            </div>
        );
    }

    return (
        <Image
            {...imageProps}
            width={width || 400}
            height={height || 300}
        />
    );
}

export default AppImage;

=== src/components/ui/AppIcon.tsx ===
'use client';

import React from 'react';
import * as HeroIcons from '@heroicons/react/24/outline';
import * as HeroIconsSolid from '@heroicons/react/24/solid';
import { QuestionMarkCircleIcon } from '@heroicons/react/24/outline';

type IconVariant = 'outline' | 'solid';

interface IconProps {
    name: string; 
    variant?: IconVariant;
    size?: number;
    className?: string;
    onClick?: () => void;
    disabled?: boolean;
    [key: string]: any;
}

function Icon({
    name,
    variant = 'outline',
    size = 24,
    className = '',
    onClick,
    disabled = false,
    ...props
}: IconProps) {
    const iconSet = variant === 'solid' ? HeroIconsSolid : HeroIcons;
    const IconComponent = iconSet[name as keyof typeof iconSet] as React.ComponentType<any>;

    if (!IconComponent) {
        return (
            <QuestionMarkCircleIcon
                width={size}
                height={size}
                className={`text-gray-400 ${disabled ? 'opacity-50 cursor-not-allowed' : ''} ${className}`}
                onClick={disabled ? undefined : onClick}
                {...props}
            />
        );
    }

    return (
        <IconComponent
            width={size}
            height={size}
            className={`${disabled ? 'opacity-50 cursor-not-allowed' : onClick ? 'cursor-pointer hover:opacity-80' : ''} ${className}`}
            onClick={disabled ? undefined : onClick}
            {...props}
        />
    );
}

export default Icon;

=== src/components/auth/AuthButton.tsx ===
// src/components/auth/AuthButton.tsx
'use client';

import { useState, useEffect } from 'react';
import Icon from '@/components/ui/AppIcon';
// FIX: Use single shared Supabase client
import { supabase } from '@/lib/supabase';

export default function AuthButton() {
  const [user, setUser] = useState<any>(null);
  const [email, setEmail] = useState('');
  const [token, setToken] = useState('');
  const [view, setView] = useState<'email' | 'code'>('email');
  const [loading, setLoading] = useState(false);
  const [message, setMessage] = useState('');

  useEffect(() => {
    supabase.auth.getSession().then(({ data: { session } }) => {
      setUser(session?.user ?? null);
    });
    const {
      data: { subscription },
    } = supabase.auth.onAuthStateChange((_event, session) => {
      setUser(session?.user ?? null);
    });
    return () => subscription.unsubscribe();
  }, []);

  const handleSendCode = async (e: React.FormEvent) => {
    e.preventDefault();
    setLoading(true);
    setMessage('');

    // Basic email validation
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailRegex.test(email)) {
      setMessage('INVALID EMAIL FORMAT');
      setLoading(false);
      return;
    }

    const { error } = await supabase.auth.signInWithOtp({
      email,
      options: { shouldCreateUser: true },
    });
    setLoading(false);
    if (error) setMessage(error.message);
    else setView('code');
  };

  const handleVerifyCode = async (e: React.FormEvent) => {
    e.preventDefault();
    setLoading(true);

    // Sanitize token: only digits, max 6
    const cleanToken = token.replace(/\D/g, '').slice(0, 6);
    if (cleanToken.length !== 6) {
      setMessage('CODE MUST BE 6 DIGITS');
      setLoading(false);
      return;
    }

    const { error } = await supabase.auth.verifyOtp({
      email,
      token: cleanToken,
      type: 'email',
    });
    setLoading(false);
    if (error) setMessage(error.message);
  };

  const handleLogout = async () => await supabase.auth.signOut();

  if (user) {
    return (
      <div className="flex items-center gap-4">
        <span className="text-[10px] font-black text-primary uppercase tracking-[0.2em] border border-primary/30 px-2 py-1">
          ALPHA
        </span>
        <button
          onClick={handleLogout}
          className="bg-white/10 text-white px-4 py-2 text-[10px] font-black hover:bg-white hover:text-black transition-all uppercase"
        >
          LOGOUT
        </button>
      </div>
    );
  }

  return (
    <div className="flex items-center gap-2">
      {view === 'email' ? (
        <form onSubmit={handleSendCode} className="flex gap-2">
          <input
            type="email"
            placeholder="ENTER EMAIL..."
            value={email}
            onChange={(e) => setEmail(e.target.value)}
            className="bg-black border border-[#222] px-4 py-2 text-[10px] text-white focus:border-primary outline-none w-48 font-black tracking-widest"
            required
            autoComplete="email"
          />
          <button
            type="submit"
            disabled={loading}
            className="bg-primary text-black px-6 py-2 text-[10px] font-black hover:bg-white transition-all uppercase disabled:opacity-50"
          >
            {loading ? '...' : 'LOGIN'}
          </button>
        </form>
      ) : (
        <form onSubmit={handleVerifyCode} className="flex gap-2">
          <input
            type="text"
            inputMode="numeric"
            pattern="[0-9]*"
            maxLength={6}
            placeholder="6-DIGIT CODE"
            value={token}
            onChange={(e) => setToken(e.target.value.replace(/\D/g, ''))}
            className="bg-black border border-primary px-4 py-2 text-[10px] text-white outline-none w-32 font-black tracking-[0.3em]"
            required
            autoComplete="one-time-code"
          />
          <button
            type="submit"
            disabled={loading}
            className="bg-white text-black px-6 py-2 text-[10px] font-black hover:bg-primary transition-all uppercase disabled:opacity-50"
          >
            {loading ? '...' : 'CONFIRM'}
          </button>
          <button
            type="button"
            onClick={() => setView('email')}
            className="text-[#555] hover:text-white p-2"
          >
            <Icon name="XMarkIcon" size={16} />
          </button>
        </form>
      )}
      {message && (
        <div className="fixed bottom-4 right-4 bg-red-600 text-white px-6 py-3 text-[10px] font-black tracking-widest shadow-2xl z-[2000]">
          {message.toUpperCase()}
        </div>
      )}
    </div>
  );
}

=== src/components/auth/AlphaGate.tsx ===
// src/components/auth/AlphaGate.tsx
'use client';

import React, { useEffect, useState } from 'react';
// FIX: Use single shared Supabase client
import { supabase } from '@/lib/supabase';
import Icon from '@/components/ui/AppIcon';

export default function AlphaGate({ children }: { children: React.ReactNode }) {
  const [session, setSession] = useState<any>(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    supabase.auth.getSession().then(({ data: { session } }) => {
      setSession(session);
      setLoading(false);
    });

    const {
      data: { subscription },
    } = supabase.auth.onAuthStateChange((_event, session) => {
      setSession(session);
    });

    return () => subscription.unsubscribe();
  }, []);

  const handleLogin = async () => {
    await supabase.auth.signInWithOAuth({
      provider: 'google',
      options: { redirectTo: `${window.location.origin}/auth/callback` },
    });
  };

  if (loading) {
    return (
      <div className="h-64 bg-[#080808] animate-pulse border border-[#1a1a1a]" />
    );
  }

  if (session) {
    return <div className="relative">{children}</div>;
  }

  return (
    <div className="relative overflow-hidden border border-[#1a1a1a] bg-[#080808]">
      <div
        className="filter blur-md opacity-20 pointer-events-none select-none grayscale"
        aria-hidden="true"
      >
        {children}
      </div>

      <div className="absolute inset-0 flex flex-col items-center justify-center z-10 bg-black/70 p-6 text-center backdrop-blur-sm">
        <div className="bg-primary/10 border-2 border-primary p-4 rounded-full mb-6 shadow-[0_0_30px_rgba(250,191,44,0.2)]">
          <Icon name="LockClosedIcon" className="text-primary" size={36} />
        </div>

        <h3 className="text-2xl font-black font-heading text-white mb-3 uppercase tracking-tighter">
          Alpha Intel <span className="text-primary">Locked</span>
        </h3>

        <p className="text-[#666] font-mono text-[10px] mb-8 max-w-sm leading-relaxed uppercase tracking-wider">
          Institutional-grade on-chain data. Join 50,000+ traders.
        </p>

        <button
          onClick={handleLogin}
          className="bg-primary text-black font-black px-8 py-3 hover:bg-white transition-all uppercase tracking-[0.2em] text-xs shadow-lg hover:scale-105"
        >
          Unlock Alpha Access
        </button>
      </div>
    </div>
  );
}

=== src/components/common/Header.tsx ===
'use client';
import React, { useState } from 'react';
import Link from 'next/link';
import AuthButton from '@/components/auth/AuthButton';

const NAV_ITEMS = [
  { 
    label: 'NEWS', 
    href: '/homepage',
    children: [
      { label: 'LATEST', href: '/homepage' },
      { label: 'BITCOIN', href: '/homepage?category=BTC' },
      { label: 'ETHEREUM', href: '/homepage?category=ETH' },
      { label: 'DEFI', href: '/homepage?category=DEFI' },
    ]
  },
  { 
    label: 'MARKETS', 
    href: '/markets-overview',
    children: [
      { label: 'SPOT', href: '/markets-overview' },
      { label: 'FUTURES', href: '/price-indexes' },
    ]
  },
  { 
    label: 'PRICES', 
    href: '/price-indexes'
  },
  { label: 'DEFI TERMINAL', href: '/de-fi-analytics' },
  { label: 'LEARNING', href: '/homepage' },
];

export default function Header() {
  const [activeMenu, setActiveMenu] = useState<string | null>(null);

  return (
    <header className="fixed top-0 left-0 right-0 z-[1000] bg-black border-b border-[#1a1a1a] h-16">
      <div className="container mx-auto h-full flex items-center justify-between px-4 lg:px-8">
        <div className="flex items-center gap-8">
          <Link href="/homepage" className="flex items-center gap-2 group">
            <div className="relative w-8 h-8 bg-primary rounded flex items-center justify-center font-black text-black">CB</div>
            <span className="text-xl font-black tracking-tighter text-white group-hover:text-primary transition-colors uppercase">
              CryptoBrain
            </span>
          </Link>

          <nav className="hidden xl:flex items-center gap-1">
            {NAV_ITEMS.map((item) => (
              <div 
                key={item.label} 
                className="relative group"
                onMouseEnter={() => setActiveMenu(item.label)}
                onMouseLeave={() => setActiveMenu(null)}
              >
                <Link 
                  href={item.href}
                  className="px-4 py-2 text-[11px] font-black text-[#888] hover:text-white uppercase tracking-widest transition-colors flex items-center gap-1"
                >
                  {item.label}
                  {item.children && <span className="text-[8px] opacity-40">▼</span>}
                </Link>

                {item.children && activeMenu === item.label && (
                  <div className="absolute top-full left-0 w-48 bg-black border border-[#1a1a1a] py-2 shadow-2xl">
                    {item.children.map((child) => (
                      <Link
                        key={child.label}
                        href={child.href}
                        className="block px-4 py-2 text-[10px] font-bold text-[#555] hover:text-primary hover:bg-white/5 transition-all"
                      >
                        {child.label}
                      </Link>
                    ))}
                  </div>
                )}
              </div>
            ))}
          </nav>
        </div>

        <div className="flex items-center gap-4">
          <Link 
            href="/go-alpha" 
            className="hidden md:block bg-primary text-black px-4 py-2 text-[10px] font-black hover:bg-white transition-all uppercase tracking-widest"
          >
            Go Alpha
          </Link>
          <AuthButton />
        </div>
      </div>
    </header>
  );
}

=== src/components/common/Breadcrumb.tsx ===
'use client';

import React from 'react';
import Link from 'next/link';
import { usePathname } from 'next/navigation';
import Icon from '@/components/ui/AppIcon';

interface BreadcrumbItem {
  label: string;
  path: string;
}

interface BreadcrumbProps {
  items?: BreadcrumbItem[];
  className?: string;
}

const Breadcrumb = ({ items, className = '' }: BreadcrumbProps) => {
  const pathname = usePathname();

  const generateBreadcrumbs = (): BreadcrumbItem[] => {
    if (items && items.length > 0) {
      return items;
    }

    // Start with Home
    const breadcrumbs: BreadcrumbItem[] = [
      { label: 'Home', path: '/homepage' }
    ];

    // Split path, filtering out empty strings
    const pathSegments = pathname.split('/').filter(segment => segment);

    // Map for pretty labels
    const pathMap: Record<string, string> = {
      'homepage': 'Home',
      'price-indexes': 'Price Indexes',
      'markets-overview': 'Markets Overview',
      'de-fi-analytics': 'DeFi Analytics',
      'article-reader': 'Article Reader'
    };

    let currentPath = '';
    
    pathSegments.forEach(segment => {
      currentPath += `/${segment}`;
      
      // Prevent adding "Home" twice if we are on /homepage
      if (currentPath === '/homepage') return;

      const label = pathMap[segment] || segment.split('-').map(word => 
        word.charAt(0).toUpperCase() + word.slice(1)
      ).join(' ');
      
      breadcrumbs.push({
        label,
        path: currentPath
      });
    });

    return breadcrumbs;
  };

  const breadcrumbItems = generateBreadcrumbs();

  // If we are just on Home, don't show breadcrumbs
  if (breadcrumbItems.length <= 1 && pathname === '/homepage') {
    return null;
  }

  return (
    <nav 
      className={`flex items-center gap-2 py-4 text-sm font-caption ${className}`}
      aria-label="Breadcrumb"
    >
      {breadcrumbItems.map((item, index) => {
        const isLast = index === breadcrumbItems.length - 1;
        const isFirst = index === 0;

        return (
          <React.Fragment key={item.path}>
            {!isFirst && (
              <Icon 
                name="ChevronRightIcon" 
                size={16} 
                className="text-muted-foreground" 
              />
            )}
            {isLast ? (
              <span 
                className="text-primary font-medium"
                aria-current="page"
              >
                {item.label}
              </span>
            ) : (
              <Link
                href={item.path}
                className="text-muted-foreground hover:text-foreground transition-smooth"
              >
                {item.label}
              </Link>
            )}
          </React.Fragment>
        );
      })}
    </nav>
  );
};

export default Breadcrumb;

=== src/components/common/PriceTicker.tsx ===
// src/components/common/PriceTicker.tsx
'use client';

import React, { useState, useEffect } from 'react';

export default function PriceTicker() {
  const [prices, setPrices] = useState<any[]>([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    let mounted = true;
    const controller = new AbortController();

    async function fetchPrices() {
      try {
        const res = await fetch('/api/prices', { signal: controller.signal });
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const data = await res.json();

        if (mounted && Array.isArray(data)) {
          setPrices(
            data.map((c: any) => ({
              symbol: (c.symbol || '').toUpperCase(),
              price: Number(c.current_price ?? 0),
              change: Number(c.price_change_percentage_24h ?? 0),
            }))
          );
        }
      } catch (e: any) {
        if (e.name !== 'AbortError') {
          console.warn('[Ticker] Fetch failed');
        }
      } finally {
        if (mounted) setLoading(false);
      }
    }

    fetchPrices();
    const interval = setInterval(fetchPrices, 60000);

    return () => {
      mounted = false;
      controller.abort();
      clearInterval(interval);
    };
  }, []);

  if (loading || prices.length === 0) {
    return (
      <div className="fixed top-16 left-0 right-0 z-[999] bg-black border-b border-primary/20 h-10 flex items-center px-4">
        <span className="text-[10px] font-mono text-primary animate-pulse tracking-[0.2em]">
          CONNECTING TO DATA FEED...
        </span>
      </div>
    );
  }

  // Double the array for seamless infinite scroll
  const displayPrices = [...prices, ...prices];

  return (
    <div className="fixed top-16 left-0 right-0 z-[999] bg-black border-b border-[#1a1a1a] h-10 flex items-center overflow-hidden">
      <div className="flex ticker-scroll whitespace-nowrap gap-6 px-4">
        {displayPrices.map((crypto, index) => (
          <div
            key={`${crypto.symbol}-${index}`}
            className="flex items-center gap-2"
          >
            <span className="text-[11px] font-black text-primary font-mono">
              {crypto.symbol}
            </span>
            <span className="text-[11px] font-bold text-white font-mono tabular-nums">
              $
              {crypto.price > 1
                ? crypto.price.toLocaleString(undefined, {
                    minimumFractionDigits: 2,
                  })
                : crypto.price.toFixed(4)}
            </span>
            <span
              className={`text-[10px] font-bold font-mono tabular-nums ${
                crypto.change >= 0 ? 'text-[#00d672]' : 'text-[#ff4757]'
              }`}
            >
              {crypto.change >= 0 ? '▲' : '▼'}{' '}
              {Math.abs(crypto.change).toFixed(2)}%
            </span>
          </div>
        ))}
      </div>
    </div>
  );
}

=== src/components/common/SearchInterface.tsx ===
'use client';

import React, { useState, useEffect, useRef } from 'react';
import Icon from '@/components/ui/AppIcon';

interface SearchResult {
  id: string;
  title: string;
  category: string;
  date: string;
  url: string;
}

interface SearchInterfaceProps {
  isOpen: boolean;
  onClose: () => void;
  className?: string;
}

const SearchInterface = ({ isOpen, onClose, className = '' }: SearchInterfaceProps) => {
  const [searchQuery, setSearchQuery] = useState('');
  const [searchResults, setSearchResults] = useState<SearchResult[]>([]);
  const [isLoading, setIsLoading] = useState(false);
  const [selectedIndex, setSelectedIndex] = useState(-1);
  const inputRef = useRef<HTMLInputElement>(null);
  const resultsRef = useRef<HTMLDivElement>(null);

  const mockResults: SearchResult[] = [
    {
      id: '1',
      title: 'Bitcoin Reaches New All-Time High Above $50,000',
      category: 'Markets',
      date: '2026-01-28',
      url: '/article-reader?id=1'
    },
    {
      id: '2',
      title: 'Ethereum 2.0 Staking Surpasses 10 Million ETH',
      category: 'DeFi',
      date: '2026-01-27',
      url: '/article-reader?id=2'
    },
    {
      id: '3',
      title: 'Solana Network Upgrade Improves Transaction Speed',
      category: 'Technology',
      date: '2026-01-26',
      url: '/article-reader?id=3'
    },
    {
      id: '4',
      title: 'Major Exchange Lists New DeFi Tokens',
      category: 'Markets',
      date: '2026-01-25',
      url: '/article-reader?id=4'
    }
  ];

  useEffect(() => {
    if (isOpen && inputRef.current) {
      inputRef.current.focus();
    }
  }, [isOpen]);

  useEffect(() => {
    const handleEscape = (e: KeyboardEvent) => {
      if (e.key === 'Escape' && isOpen) {
        onClose();
      }
    };

    document.addEventListener('keydown', handleEscape);
    return () => document.removeEventListener('keydown', handleEscape);
  }, [isOpen, onClose]);

  useEffect(() => {
    if (searchQuery.trim().length > 0) {
      setIsLoading(true);
      const timer = setTimeout(() => {
        const filtered = mockResults.filter(result =>
          result.title.toLowerCase().includes(searchQuery.toLowerCase()) ||
          result.category.toLowerCase().includes(searchQuery.toLowerCase())
        );
        setSearchResults(filtered);
        setIsLoading(false);
        setSelectedIndex(-1);
      }, 300);

      return () => clearTimeout(timer);
    } else {
      setSearchResults([]);
      setSelectedIndex(-1);
    }
  }, [searchQuery]);

  const handleKeyDown = (e: React.KeyboardEvent) => {
    if (searchResults.length === 0) return;

    if (e.key === 'ArrowDown') {
      e.preventDefault();
      setSelectedIndex(prev => 
        prev < searchResults.length - 1 ? prev + 1 : prev
      );
    } else if (e.key === 'ArrowUp') {
      e.preventDefault();
      setSelectedIndex(prev => prev > 0 ? prev - 1 : -1);
    } else if (e.key === 'Enter' && selectedIndex >= 0) {
      e.preventDefault();
      window.location.href = searchResults[selectedIndex].url;
    }
  };

  const handleResultClick = (url: string) => {
    window.location.href = url;
    onClose();
  };

  const handleClear = () => {
    setSearchQuery('');
    setSearchResults([]);
    setSelectedIndex(-1);
    inputRef.current?.focus();
  };

  if (!isOpen) return null;

  return (
    <div className={`fixed inset-0 z-[1001] bg-background ${className}`}>
      <div className="flex items-start justify-center min-h-screen px-4 pt-20">
        <div className="w-full max-w-3xl">
          {/* Search Input */}
          <div className="relative">
            <div className="absolute left-6 top-1/2 -translate-y-1/2">
              <Icon name="MagnifyingGlassIcon" size={24} className="text-muted-foreground" />
            </div>
            <input
              ref={inputRef}
              type="text"
              value={searchQuery}
              onChange={(e) => setSearchQuery(e.target.value)}
              onKeyDown={handleKeyDown}
              placeholder="Search crypto news, markets, and analytics..."
              className="w-full h-16 pl-16 pr-16 text-lg bg-card text-foreground border border-border focus:outline-none focus:ring-2 focus:ring-primary rounded-[4px]"
            />
            {searchQuery && (
              <button
                onClick={handleClear}
                className="absolute right-6 top-1/2 -translate-y-1/2 p-2 text-muted-foreground hover:text-foreground transition-smooth"
                aria-label="Clear search"
              >
                <Icon name="XMarkIcon" size={20} />
              </button>
            )}
          </div>

          {/* Search Results */}
          {searchQuery.trim().length > 0 && (
            <div 
              ref={resultsRef}
              className="mt-4 bg-card border border-border shadow-lg max-h-[60vh] overflow-y-auto"
            >
              {isLoading ? (
                <div className="flex items-center justify-center py-12">
                  <div className="text-muted-foreground font-caption">Searching...</div>
                </div>
              ) : searchResults.length > 0 ? (
                <div className="divide-y divide-border">
                  {searchResults.map((result, index) => (
                    <button
                      key={result.id}
                      onClick={() => handleResultClick(result.url)}
                      className={`w-full text-left px-6 py-4 transition-smooth ${
                        index === selectedIndex
                          ? 'bg-primary text-primary-foreground'
                          : 'hover:bg-muted'
                      }`}
                    >
                      <div className="flex items-start justify-between gap-4">
                        <div className="flex-1 min-w-0">
                          <h3 className="text-base font-medium font-heading mb-1 truncate">
                            {result.title}
                          </h3>
                          <div className="flex items-center gap-3 text-xs font-caption">
                            <span className={index === selectedIndex ? 'opacity-80' : 'text-primary'}>
                              {result.category}
                            </span>
                            <span className={index === selectedIndex ? 'opacity-60' : 'text-muted-foreground'}>
                              {new Date(result.date).toLocaleDateString('en-US', {
                                month: 'short',
                                day: 'numeric',
                                year: 'numeric'
                              })}
                            </span>
                          </div>
                        </div>
                        <Icon 
                          name="ArrowRightIcon" 
                          size={20} 
                          className={index === selectedIndex ? 'opacity-80' : 'text-muted-foreground'}
                        />
                      </div>
                    </button>
                  ))}
                </div>
              ) : (
                <div className="flex flex-col items-center justify-center py-12 px-6 text-center">
                  <Icon name="MagnifyingGlassIcon" size={48} className="text-muted-foreground mb-4" />
                  <p className="text-muted-foreground font-caption">
                    No results found for "{searchQuery}"
                  </p>
                  <p className="text-sm text-muted-foreground mt-2">
                    Try different keywords or browse our categories
                  </p>
                </div>
              )}
            </div>
          )}

          {/* Close Button */}
          <button
            onClick={onClose}
            className="mt-8 px-6 py-3 text-sm font-medium text-foreground hover:text-primary transition-smooth flex items-center gap-2"
          >
            <Icon name="XMarkIcon" size={20} />
            Close Search
          </button>

          {/* Keyboard Shortcuts Hint */}
          <div className="mt-8 flex items-center gap-6 text-xs text-muted-foreground font-caption">
            <div className="flex items-center gap-2">
              <kbd className="px-2 py-1 bg-muted border border-border">↑↓</kbd>
              <span>Navigate</span>
            </div>
            <div className="flex items-center gap-2">
              <kbd className="px-2 py-1 bg-muted border border-border">Enter</kbd>
              <span>Select</span>
            </div>
            <div className="flex items-center gap-2">
              <kbd className="px-2 py-1 bg-muted border border-border">Esc</kbd>
              <span>Close</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

export default SearchInterface;

=== src/styles/globals.css ===
/* src/styles/globals.css */
@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  :root {
    --font-heading: 'Merriweather', serif;
    --font-body: 'Inter', sans-serif;
    --font-caption: 'JetBrains Mono', monospace;
    --font-data: 'Space Mono', monospace;

    --color-background: #000000;
    --color-foreground: #ffffff;
    --color-primary: #FABF2C;
    --color-primary-foreground: #000000;
    --color-border: #1a1a1a;
    --color-card: #0a0a0a;
    --color-card-foreground: #ffffff;
    --color-muted: #111111;
    --color-muted-foreground: #888888;
    --color-secondary: #0f0f0f;
    --color-success: #00d672;
    --color-error: #ff4757;
  }

  body {
    @apply bg-[var(--color-background)] text-[var(--color-foreground)] font-body antialiased;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }

  h1, h2, h3, h4, h5, h6 {
    @apply font-heading font-bold;
  }

  /* Monospace numbers everywhere for data alignment */
  .tabular-nums {
    font-variant-numeric: tabular-nums;
  }
}

@layer utilities {
  .transition-smooth {
    @apply transition-all duration-200 ease-in-out;
  }
}

/* ─── Price Ticker Animation ──────────────────────────────────────────── */
@keyframes ticker-scroll {
  0% { transform: translateX(0); }
  100% { transform: translateX(-50%); }
}

.ticker-scroll {
  animation: ticker-scroll 80s linear infinite;
}

.ticker-scroll:hover {
  animation-play-state: paused;
}

/* ─── Reading progress bar animation ──────────────────────────────────── */
@keyframes reading-bar {
  0% { width: 0%; }
  100% { width: 100%; }
}

.animate-reading-bar {
  animation: reading-bar 5s ease-in-out forwards;
}

/* ─── Scrollbar styling (Bloomberg-style) ─────────────────────────────── */
::-webkit-scrollbar {
  width: 6px;
  height: 6px;
}

::-webkit-scrollbar-track {
  background: #000;
}

::-webkit-scrollbar-thumb {
  background: #222;
  border-radius: 0;
}

::-webkit-scrollbar-thumb:hover {
  background: #333;
}

/* ─── Selection color ─────────────────────────────────────────────────── */
::selection {
  background: #FABF2C;
  color: #000;
}

